# Replit Instructions: Fix Overdue Task Logic

**ISSUE: Tasks due today and tomorrow are incorrectly marked as overdue**

## The Correct Overdue Logic Should Be:

A task is overdue if:
1. Due date is BEFORE today (past dates), OR
2. Due date is TODAY AND current time is AFTER 8:30 PM

A task is NOT overdue if:
- Due date is in the future (tomorrow or later)
- Due date is today but it's still before 8:30 PM

## Step 1: Find and Fix the Overdue Calculation

Search for where tasks are marked as overdue and replace with correct logic:

```tsx
const isTaskOverdue = (task) => {
  // Cannot be overdue if already completed
  if (task.status === 'completed') {
    return false;
  }
  
  // Must have a due date to be overdue
  if (!task.dueDate) {
    return false;
  }
  
  const now = new Date();
  const dueDate = new Date(task.dueDate);
  
  // Reset times to compare just the dates
  const todayStart = new Date(now);
  todayStart.setHours(0, 0, 0, 0);
  
  const dueDateStart = new Date(dueDate);
  dueDateStart.setHours(0, 0, 0, 0);
  
  // If due date is in the future, NOT overdue
  if (dueDateStart > todayStart) {
    console.log(`Task due ${dueDate.toLocaleDateString()} is in the future, not overdue`);
    return false;
  }
  
  // If due date is in the past, IS overdue
  if (dueDateStart < todayStart) {
    console.log(`Task due ${dueDate.toLocaleDateString()} is in the past, is overdue`);
    return true;
  }
  
  // Due date is today - check if past 8:30 PM
  const deadline = new Date(todayStart);
  deadline.setHours(20, 30, 0, 0); // 8:30 PM
  
  const isOverdue = now > deadline;
  console.log(`Task due today: current time ${now.toLocaleTimeString()}, deadline 8:30 PM, overdue: ${isOverdue}`);
  
  return isOverdue;
};
```

## Step 2: Fix the Task Status Display

Update where the overdue status is displayed:

```tsx
const getTaskStatus = (task) => {
  if (task.status === 'completed') {
    return {
      label: 'Completed',
      className: 'status-completed',
      isOverdue: false
    };
  }
  
  if (task.status === 'in-progress') {
    return {
      label: 'In Progress',
      className: 'status-in-progress',
      isOverdue: false
    };
  }
  
  // Check if overdue
  const overdue = isTaskOverdue(task);
  
  if (overdue) {
    return {
      label: 'Overdue',
      className: 'status-overdue',
      isOverdue: true
    };
  }
  
  return {
    label: 'Pending',
    className: 'status-pending',
    isOverdue: false
  };
};
```

## Step 3: Fix the Due Date Display

Make sure "Due today" and "Due tomorrow" show correctly:

```tsx
const getDueDateDisplay = (task) => {
  if (!task.dueDate) return 'No due date';
  
  const now = new Date();
  const dueDate = new Date(task.dueDate);
  
  // Reset to start of day for comparison
  const todayStart = new Date(now);
  todayStart.setHours(0, 0, 0, 0);
  
  const tomorrowStart = new Date(todayStart);
  tomorrowStart.setDate(tomorrowStart.getDate() + 1);
  
  const dueDateStart = new Date(dueDate);
  dueDateStart.setHours(0, 0, 0, 0);
  
  // Calculate difference in days
  const msPerDay = 24 * 60 * 60 * 1000;
  const daysUntilDue = Math.round((dueDateStart - todayStart) / msPerDay);
  
  if (daysUntilDue < 0) {
    return `Overdue by ${Math.abs(daysUntilDue)} day${Math.abs(daysUntilDue) !== 1 ? 's' : ''}`;
  } else if (daysUntilDue === 0) {
    return 'Due today';
  } else if (daysUntilDue === 1) {
    return 'Due tomorrow';
  } else {
    return `Due in ${daysUntilDue} days`;
  }
};
```

## Step 4: Add Date Display for Debugging

Temporarily add the actual due date to help debug:

```tsx
// In the task card display
<div className="task-due-date">
  <span>{getDueDateDisplay(task)}</span>
  <span className="debug-date"> ({new Date(task.dueDate).toLocaleDateString()})</span>
</div>
```

## Step 5: Search and Fix All Overdue Checks

Search the codebase for all places checking overdue status:

```bash
# Search for overdue logic
Search for: "overdue"
Search for: "Overdue"
Search for: "isOverdue"
Search for: "checkOverdue"
Search for: "deadline"
```

Replace any found logic with the correct calculation from Step 1.

## Step 6: Test Cases

Add logging to verify the logic works correctly:

```tsx
// Test the overdue logic
const testOverdueLogic = () => {
  const testCases = [
    { dueDate: new Date(2025, 7, 31), desc: 'Yesterday (Jul 31)' },  // Should be overdue
    { dueDate: new Date(2025, 8, 1), desc: 'Today (Aug 1) at 9 AM' }, // Not overdue (before 8:30 PM)
    { dueDate: new Date(2025, 8, 1, 21, 0), desc: 'Today (Aug 1) at 9 PM' }, // Overdue (after 8:30 PM)
    { dueDate: new Date(2025, 8, 2), desc: 'Tomorrow (Aug 2)' }, // Not overdue
    { dueDate: new Date(2025, 8, 3), desc: 'Day after tomorrow' }, // Not overdue
  ];
  
  console.log('Testing overdue logic at:', new Date().toLocaleString());
  testCases.forEach(test => {
    const task = { dueDate: test.dueDate.toISOString(), status: 'pending' };
    const overdue = isTaskOverdue(task);
    console.log(`${test.desc}: ${overdue ? 'OVERDUE' : 'Not overdue'}`);
  });
};

// Run test on page load
testOverdueLogic();
```

## Summary

The key fix is to ensure:
1. **Future dates are NEVER overdue** - If due date > today, not overdue
2. **Past dates are ALWAYS overdue** - If due date < today, overdue
3. **Today has a deadline** - Only overdue after 8:30 PM on the due date

This should fix the issue where tasks due today (Aug 1) and tomorrow (Aug 2) are being incorrectly marked as overdue!