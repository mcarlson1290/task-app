# Replit Instructions: Fix Single Variety SKU Display

**ISSUE: When there's only one variety, Tray ID shows "MIX" instead of the actual seed SKU**

## Step 1: Update Tray ID Generation Logic

Find where the Tray ID is generated and fix the SKU logic:

```tsx
const generateTrayId = (trayType, varieties) => {
  const date = new Date();
  const dateStr = `${(date.getMonth() + 1).toString().padStart(2, '0')}${date.getDate().toString().padStart(2, '0')}${date.getFullYear().toString().slice(2)}`;
  const location = 'K'; // Kenosha
  
  // Determine SKU based on varieties
  let sku = 'MIX'; // Default for multiple varieties
  
  if (varieties && varieties.length === 1 && varieties[0].seedId) {
    // Single variety - use its SKU
    sku = varieties[0].seedId; // e.g., 'ARU', 'ROM', 'BAS'
  } else if (varieties && varieties.length > 1) {
    // Multiple varieties - use 'MIX'
    sku = 'MIX';
  }
  
  const instanceNum = 1; // Or from form
  
  return `${location}${dateStr}-${trayType}-${sku}-${instanceNum}`;
};
```

## Step 2: Update Button Text

Change the button text based on variety count:

```tsx
const getButtonText = () => {
  if (varieties.length === 0) {
    return 'Create Tray';
  } else if (varieties.length === 1) {
    return 'Create Tray'; // Single variety, no need for "Multi-Variety"
  } else {
    return 'Create Multi-Variety Tray';
  }
};

// In render:
<button onClick={handleCreate} className="create-button">
  {getButtonText()}
</button>
```

## Step 3: Update the Tray ID Display

Make sure the Tray ID updates in real-time as varieties change:

```tsx
// Add a computed tray ID that updates automatically
const computedTrayId = useMemo(() => {
  return generateTrayId(trayType, varieties);
}, [trayType, varieties]);

// Display it
<div className="tray-id-display">
  <strong>Tray ID:</strong> {computedTrayId}
</div>
```

## Step 4: Update UI Labels

Change labels based on variety count:

```tsx
// Instead of always showing "Crop Varieties"
const getVarietiesLabel = () => {
  if (trayType === 'MG') {
    return 'Microgreen Variety'; // Singular for microgreens
  } else if (varieties.length <= 1) {
    return 'Crop Variety';
  } else {
    return 'Crop Varieties';
  }
};
```

## Step 5: Update Total Plants Display

Adjust the display based on variety count:

```tsx
// For single variety
if (varieties.length === 1) {
  return `Total Plants: ${varieties[0].quantity || 0} / ${totalSlots}`;
} else {
  // For multiple varieties
  const total = varieties.reduce((sum, v) => sum + (v.quantity || 0), 0);
  return `Total Plants: ${total} / ${totalSlots} slots`;
}
```

## Step 6: Handle Edge Cases

Make sure SKU extraction works properly:

```tsx
// Ensure seedId is properly extracted
const getSeedSku = (seed) => {
  if (!seed || !seed.seedId) return 'UNK'; // Unknown
  
  // Extract SKU - might be stored as "ARU" or "[ARU] Arugula Seeds"
  if (seed.seedId.includes('[')) {
    // Extract from brackets: "[ARU]" -> "ARU"
    const match = seed.seedId.match(/\[([^\]]+)\]/);
    return match ? match[1] : 'UNK';
  }
  
  // Already just the SKU
  return seed.seedId.toUpperCase();
};
```

## Summary of Changes:
- Single variety: Tray ID shows actual SKU (K080125-MG-ARU-1)
- Multiple varieties: Tray ID shows MIX (K080125-MG-MIX-1)
- Button text changes: "Create Tray" for single, "Create Multi-Variety Tray" for multiple
- Labels adjust: "Microgreen Variety" vs "Crop Varieties"
- All UI elements reflect whether it's single or multi-variety