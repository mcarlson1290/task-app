# Replit Instructions: Fix Create Tray - Complete Implementation

**CRITICAL ISSUES TO FIX:**
1. Seed selection shows "Select seed..." but no dropdown options (not connected to inventory)
2. Growing Medium shows "Select Medium" but no dropdown options
3. Varieties section needs to be a dropdown selection, not text input
4. Missing configuration options in the recurring task builder

## Issue 1: Connect Seed Selection to Real Inventory

### Find where Create Tray component is defined and update it:

```tsx
// In the Create Tray component, add this to load seeds from inventory:

useEffect(() => {
  // Load inventory from localStorage
  const inventoryData = localStorage.getItem('inventory');
  if (inventoryData) {
    const allInventory = JSON.parse(inventoryData);
    // Filter to only seed items - check for items with 'seed' in name or category
    const seedItems = allInventory.filter((item: any) => 
      item.category?.toLowerCase().includes('seed') || 
      item.name?.toLowerCase().includes('seed') ||
      item.type?.toLowerCase() === 'seeds'
    );
    
    // If no seeds found, check if inventory has different structure
    if (seedItems.length === 0) {
      console.log('No seeds found in inventory. Current inventory structure:', allInventory);
      // Create some default seeds for testing
      const defaultSeeds = [
        { id: 'seed-1', name: 'Broccoli Microgreens Seeds', sku: 'BROC', quantity: 50, unit: 'oz' },
        { id: 'seed-2', name: 'Romaine Lettuce Seeds', sku: 'ROMN', quantity: 30, unit: 'oz' },
        { id: 'seed-3', name: 'Genovese Basil Seeds', sku: 'BASIL', quantity: 25, unit: 'oz' },
        { id: 'seed-4', name: 'Arugula Seeds', sku: 'ARUG', quantity: 40, unit: 'oz' }
      ];
      setAvailableSeeds(defaultSeeds);
    } else {
      setAvailableSeeds(seedItems);
    }
  } else {
    console.log('No inventory found in localStorage');
  }
}, []);
```

### Update the seed dropdown to show actual options:

```tsx
<div className="form-group">
  <label>Select Seed Type*</label>
  <select 
    value={selectedSeed?.id || ''} 
    onChange={(e) => {
      const seed = availableSeeds.find(s => s.id === e.target.value);
      setSelectedSeed(seed || null);
    }}
    className="form-control"
  >
    <option value="">Select seed...</option>
    {availableSeeds.length === 0 ? (
      <option disabled>No seeds in inventory</option>
    ) : (
      availableSeeds.map(seed => (
        <option key={seed.id} value={seed.id}>
          {seed.name} - {seed.sku || 'No SKU'} ({seed.quantity || 0} {seed.unit || 'units'} available)
        </option>
      ))
    )}
  </select>
</div>
```

## Issue 2: Fix Growing Medium Dropdown

```tsx
<div className="form-group">
  <label>Growing Medium*</label>
  <select 
    value={growingMedium} 
    onChange={(e) => setGrowingMedium(e.target.value)}
    className="form-control"
  >
    <option value="">Select Medium</option>
    <option value="Oasis Cubes">Oasis Cubes</option>
    <option value="Rockwool">Rockwool</option>
    <option value="Hemp Mat">Hemp Mat</option>
  </select>
</div>
```

## Issue 3: Change Varieties to Dropdown Selection

```tsx
// First, load available varieties from inventory or define them
const [availableVarieties, setAvailableVarieties] = useState<string[]>([]);

useEffect(() => {
  // Define standard varieties based on selected seed
  if (selectedSeed) {
    // You can customize varieties per seed type
    const varietiesBySeed: Record<string, string[]> = {
      'BROC': ['Calabrese', 'De Cicco', 'Waltham 29', 'Standard'],
      'ROMN': ['Parris Island', 'Little Gem', 'Vivian', 'Cos', 'Standard'],
      'BASIL': ['Genovese', 'Sweet', 'Purple Ruffles', 'Lemon', 'Thai', 'Standard'],
      'ARUG': ['Astro', 'Roquette', 'Wild Rocket', 'Standard'],
      'KALE': ['Dwarf Blue Curled', 'Winterbor', 'Red Russian', 'Lacinato', 'Standard'],
      'RADI': ['China Rose', 'Daikon', 'Red Arrow', 'Standard'],
      'SUNF': ['Black Oil', 'Mammoth', 'Standard'],
      'PEAS': ['Dwarf Grey Sugar', 'Oregon Sugar Pod', 'Standard']
    };
    
    const varieties = varietiesBySeed[selectedSeed.sku] || ['Standard'];
    setAvailableVarieties(varieties);
  } else {
    // Default varieties if no seed selected
    setAvailableVarieties(['Standard']);
  }
}, [selectedSeed]);const varietiesBySeed: Record<string, string[]> = {
      'BROC': ['Calabrese', 'De Cicco', 'Waltham 29'],
      'ROMN': ['Parris Island', 'Little Gem', 'Vivian'],
      'BASIL': ['Genovese', 'Sweet', 'Purple Ruffles'],
      'ARUG': ['Astro', 'Roquette', 'Wild Rocket']
    };
    
    const varieties = varietiesBySeed[selectedSeed.sku] || ['Standard'];
    setAvailableVarieties(varieties);
  }
}, [selectedSeed]);

// Update the varieties section:
<div className="varieties-section">
  <label>Varieties</label>
  {varieties.map((variety, index) => (
    <div key={variety.id} className="variety-row">
      <select
        value={variety.name}
        onChange={(e) => updateVariety(variety.id, 'name', e.target.value)}
        className="form-control"
      >
        <option value="">Select variety...</option>
        {availableVarieties.map(v => (
          <option key={v} value={v}>{v}</option>
        ))}
      </select>
      <input
        type="number"
        value={variety.percentage}
        onChange={(e) => updateVariety(variety.id, 'percentage', parseInt(e.target.value) || 0)}
        placeholder="%"
        min={0}
        max={100}
        className="percentage-input"
      />
      {varieties.length > 1 && (
        <button onClick={() => removeVariety(variety.id)} className="remove-btn">
          <Minus size={16} />
        </button>
      )}
    </div>
  ))}
  <button onClick={addVariety} className="add-variety-btn">
    <Plus size={16} /> Add Variety
  </button>
</div>
```

## Issue 4: Add Configuration Options to Recurring Task Builder

In the recurring task creation/edit form, when "Create Tray" is selected as step type:

```tsx
{selectedStepType === 'Create Tray' && (
  <>
    <div className="form-group">
      <label>Default Tray Type</label>
      <select 
        value={defaultTrayType} 
        onChange={(e) => setDefaultTrayType(e.target.value)}
      >
        <option value="LG">LG - Leafy Greens</option>
        <option value="MG">MG - Microgreens</option>
        <option value="HB">HB - Herbs</option>
      </select>
    </div>

    <div className="form-group">
      <label>Default Instance Number</label>
      <input
        type="number"
        value={defaultInstance}
        onChange={(e) => setDefaultInstance(parseInt(e.target.value) || 1)}
        min={1}
        max={99}
        placeholder="1"
      />
      <small>This can be changed during task execution</small>
    </div>

    <div className="form-group">
      <label>Default Seeds Amount (oz)</label>
      <input
        type="number"
        value={defaultSeedsOz}
        onChange={(e) => setDefaultSeedsOz(e.target.value)}
        placeholder="0.5"
        step="0.1"
      />
      <small>Suggested amount, can be adjusted during execution</small>
    </div>

    <div className="form-group">
      <label>Preferred Growing Medium</label>
      <select 
        value={defaultGrowingMedium} 
        onChange={(e) => setDefaultGrowingMedium(e.target.value)}
      >
        <option value="">User selects during execution</option>
        <option value="Oasis Cubes">Oasis Cubes</option>
        <option value="Rockwool">Rockwool</option>
        <option value="Hemp Mat">Hemp Mat</option>
      </select>
    </div>
  </>
)}
```

## Issue 5: Pass Defaults to Create Tray Component

When rendering the Create Tray step in the checklist:

```tsx
{step.type === 'Create Tray' && !step.completed && currentStepIndex === index && (
  <CreateTrayStep
    stepData={step}
    onComplete={(data) => {
      updateStepCompletion(index, true, data);
      setCurrentStepIndex(index + 1);
    }}
    defaultInstance={step.defaultInstance || 1}
    defaultTrayType={step.defaultTrayType || 'LG'}
    defaultSeedsOz={step.defaultSeedsOz || ''}
    defaultGrowingMedium={step.defaultGrowingMedium || ''}
  />
)}
```

## Issue 6: Initialize Inventory with Seed Data (if needed)

Add this to your app initialization:

```tsx
const initializeInventory = () => {
  const existingInventory = localStorage.getItem('inventory');
  if (!existingInventory || JSON.parse(existingInventory).length === 0) {
    const seedInventory = [
      { 
        id: 'inv-seed-1', 
        name: 'Broccoli Microgreens Seeds', 
        sku: 'BROC', 
        category: 'Seeds',
        quantity: 50, 
        unit: 'oz',
        reorderPoint: 10,
        supplier: 'Johnny Seeds'
      },
      { 
        id: 'inv-seed-2', 
        name: 'Romaine Lettuce Seeds', 
        sku: 'ROMN', 
        category: 'Seeds',
        quantity: 30, 
        unit: 'oz',
        reorderPoint: 5,
        supplier: 'High Mowing Seeds'
      },
      { 
        id: 'inv-seed-3', 
        name: 'Genovese Basil Seeds', 
        sku: 'BASIL', 
        category: 'Seeds',
        quantity: 25, 
        unit: 'oz',
        reorderPoint: 5,
        supplier: 'Johnny Seeds'
      },
      { 
        id: 'inv-seed-4', 
        name: 'Arugula Seeds', 
        sku: 'ARUG', 
        category: 'Seeds',
        quantity: 40, 
        unit: 'oz',
        reorderPoint: 8,
        supplier: 'High Mowing Seeds'
      }
    ];
    localStorage.setItem('inventory', JSON.stringify(seedInventory));
  }
};

// Call this on app load
initializeInventory();
```

## CRITICAL DEBUGGING STEPS:

1. **Check inventory structure**: Add console.log to see what's in localStorage
2. **Verify dropdown population**: Log the availableSeeds array
3. **Test with defaults**: If inventory is empty, populate with test data
4. **Check event handlers**: Ensure onChange events are properly wired

The main issue is that the dropdowns aren't connected to real data sources. This implementation:
- Connects to actual inventory data
- Provides fallback options if inventory is empty
- Makes varieties selectable from dropdowns
- Adds all configuration options to the recurring task builder