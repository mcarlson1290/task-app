# Replit Instructions: Fix Legacy Automation Text and Date Filter

## Issue 1: Remove Legacy "Generates production day" Text

### Step 1: Update Task Display Logic
Find where tasks display automation information and update it:

```javascript
// In the task card or task details component
const TaskAutomation = ({ task }) => {
  // Remove any hardcoded automation text based on task type
  
  // If task has specific automations attached
  if (task.automations && task.automations.length > 0) {
    return (
      <div className="task-automations">
        <span className="automation-label">Automations:</span>
        {task.automations.map(automation => (
          <span key={automation.id} className="automation-item">
            {automation.name}
          </span>
        ))}
      </div>
    );
  }
  
  // Don't show anything if no automations
  return null;
};
```

### Step 2: Remove Task Type Automation Logic
Update any code that automatically adds automation text based on task type:

```javascript
// Remove or comment out old logic like this:
// if (task.type === 'harvest') {
//   task.automation = 'Generates production day when completed';
// }

// Task type should now only be used for categorization
const getTaskTypeIcon = (type) => {
  switch(type) {
    case 'harvest': return 'ðŸŒ±';
    case 'maintenance': return 'ðŸ”§';
    case 'cleaning': return 'ðŸ§¹';
    default: return 'ðŸ“‹';
  }
};
```

### Step 3: Add Automation Management (Future)
Prepare structure for independent automation system:

```javascript
// Database schema for future automation system
CREATE TABLE task_automations (
  id SERIAL PRIMARY KEY,
  task_id INTEGER REFERENCES tasks(id),
  automation_type VARCHAR(50), -- 'generate_production', 'send_notification', etc.
  automation_config JSONB,
  created_at TIMESTAMP DEFAULT NOW()
);
```

## Issue 2: Default Tasks Page to Today's Date

### Step 1: Set Initial Date Filter
In the Tasks page component, update the initial state:

```javascript
const TasksPage = () => {
  // Change from empty/null to today's date
  const [selectedDate, setSelectedDate] = useState(() => {
    const today = new Date();
    return today.toISOString().split('T')[0]; // Format: YYYY-MM-DD
  });
  
  // Or if using a different date format
  const [dateFilter, setDateFilter] = useState(() => {
    return new Date().toLocaleDateString('en-US'); // Format: MM/DD/YYYY
  });
  
  // ... rest of component
};
```

### Step 2: Update Date Input Default
Ensure the date input shows today's date on load:

```javascript
<input
  type="date"
  value={selectedDate}
  onChange={(e) => setSelectedDate(e.target.value)}
  className="date-filter"
/>
```

### Step 3: Update Task Query
Make sure the task fetch uses the selected date:

```javascript
useEffect(() => {
  fetchTasksForDate(selectedDate);
}, [selectedDate]);

const fetchTasksForDate = async (date) => {
  try {
    const response = await fetch(`/api/tasks?date=${date}`);
    const data = await response.json();
    setTasks(data.tasks);
  } catch (error) {
    console.error('Error fetching tasks:', error);
  }
};
```

### Step 4: Add "Today" Button
Add a convenient button to return to today:

```javascript
<div className="date-controls">
  <button onClick={() => setSelectedDate(new Date().toISOString().split('T')[0])}>
    Today
  </button>
  <input
    type="date"
    value={selectedDate}
    onChange={(e) => setSelectedDate(e.target.value)}
  />
</div>
```

## Issue 3: Fix Recurring Task Edit Propagation

### Step 1: Add Refresh After Edit
In the recurring task edit handler:

```javascript
const handleEditRecurringTask = async (taskId, updates) => {
  try {
    const response = await fetch(`/api/recurring-tasks/${taskId}`, {
      method: 'PUT',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(updates)
    });
    
    if (response.ok) {
      showNotification('Recurring task updated', 'success');
      
      // Refresh both recurring tasks and regular tasks
      await fetchRecurringTasks();
      await fetchTasksForDate(selectedDate); // Refresh current day's tasks
      
      // Close edit modal
      setEditModalOpen(false);
    }
  } catch (error) {
    console.error('Error updating recurring task:', error);
  }
};
```

### Step 2: Add Loading State During Update
Show that propagation is happening:

```javascript
const [isPropagating, setIsPropagating] = useState(false);

const handleEditRecurringTask = async (taskId, updates) => {
  setIsPropagating(true);
  try {
    // ... update logic ...
    
    // Show propagation message
    showNotification('Updating all future instances...', 'info');
    
    // ... rest of logic ...
  } finally {
    setIsPropagating(false);
  }
};

// In the UI
{isPropagating && (
  <div className="propagation-notice">
    Updating all future task instances...
  </div>
)}
```

### Step 3: Verify Backend Propagation
Ensure the backend is updating all instances:

```javascript
// In the API endpoint for updating recurring tasks
app.put('/api/recurring-tasks/:id', async (req, res) => {
  const { id } = req.params;
  const updates = req.body;
  
  try {
    // Start transaction
    await db.query('BEGIN');
    
    // Update recurring task
    await db.query(`UPDATE recurring_tasks SET ... WHERE id = $1`, [id]);
    
    // Update all pending future instances
    const result = await db.query(`
      UPDATE tasks 
      SET 
        name = $1,
        description = $2,
        assigned_role = $3,
        updated_at = NOW()
      WHERE 
        recurring_task_id = $4
        AND status = 'pending'
        AND due_date >= CURRENT_DATE
      RETURNING id
    `, [updates.name, updates.description, updates.assigned_role, id]);
    
    await db.query('COMMIT');
    
    res.json({ 
      success: true, 
      updated_instances: result.rowCount 
    });
    
  } catch (error) {
    await db.query('ROLLBACK');
    res.status(500).json({ error: 'Failed to update' });
  }
});
```

## Testing Checklist:
- [ ] Task cards no longer show "Generates production day" text
- [ ] Tasks page loads with today's date selected by default
- [ ] Changing date filter shows tasks for selected date
- [ ] Editing recurring task updates all future instances
- [ ] Page refreshes to show updated task names/details
- [ ] Only pending (unstarted) tasks are updated