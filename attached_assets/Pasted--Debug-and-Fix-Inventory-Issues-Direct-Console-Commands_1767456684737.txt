# Debug and Fix Inventory Issues - Direct Console Commands

## STEP 1: Check What's Actually in the Database

Open your browser console (F12 â†’ Console tab) and paste this:

```javascript
// Fetch ALL inventory items directly from API
fetch('/api/inventory')
  .then(r => r.json())
  .then(items => {
    console.log('ðŸ“¦ Total items in database:', items.length);
    console.table(items.map(i => ({
      id: i.id,
      name: i.name,
      sku: i.sku,
      stock: i.currentStock,
      trackingCategory: i.trackingCategory,
      location: i.location
    })));
  });
```

**Tell me what this shows!** Specifically:
- How many items total?
- Do they have `trackingCategory`?
- Do they have `location`?

---

## STEP 2: Delete ALL Old Inventory Items

If you see old items (Lettuce Seeds, Spinach Seeds, Hemp Mats with ids 1-17), delete them all:

```javascript
// Delete ALL inventory items
fetch('/api/inventory')
  .then(r => r.json())
  .then(items => {
    console.log(`ðŸ—‘ï¸  Deleting ${items.length} items...`);
    
    // Delete each item
    const deletePromises = items.map(item => 
      fetch(`/api/inventory/${item.id}`, { method: 'DELETE' })
        .then(() => console.log(`âœ… Deleted: ${item.name} (id: ${item.id})`))
    );
    
    return Promise.all(deletePromises);
  })
  .then(() => {
    console.log('ðŸŽ‰ All items deleted! Refreshing page...');
    location.reload();
  })
  .catch(err => console.error('âŒ Error:', err));
```

**This will completely clear your inventory.**

---

## STEP 3: Test Adding a Simple Item

After deleting everything, try adding a test item through the UI:

1. Click "Add to Inventory"
2. Fill ONLY these fields:
   - Name: "Test Item"
   - SKU: "TEST"
   - Quantity: 1
   - Leave everything else blank/default
3. Click "Add New Item"

**Then run this in console:**

```javascript
fetch('/api/inventory')
  .then(r => r.json())
  .then(items => {
    console.log('ðŸ“¦ Items after adding test:', items.length);
    if (items.length > 0) {
      console.log('âœ… Item created:', items[0]);
      console.log('ðŸ” Has trackingCategory?', items[0].trackingCategory);
      console.log('ðŸ” Has location?', items[0].location);
    }
  });
```

---

## STEP 4: Check for JavaScript Errors

In the browser console, look for RED error messages when you click "Add New Item".

Common errors to look for:
- `Cannot read property 'trackingCategory' of undefined`
- `xyz is not a function`
- `Failed to fetch`
- Network errors (check Network tab)

**Copy and paste ANY red error messages you see!**

---

## STEP 5: Check Current Filters

Maybe filters are hiding items. Run this:

```javascript
// Check what filters are active
console.log('Current filters:', {
  categoryFilter: document.querySelector('[name="category"]')?.value,
  searchTerm: document.querySelector('input[type="search"]')?.value,
  trackingCategoryFilter: 'check if this exists'
});
```

---

## COMMON ISSUES & FIXES

### Issue 1: Items Missing trackingCategory Field

**Problem:** Old items don't have `trackingCategory`, new schema requires it.

**Fix - Run in Replit Shell or add this endpoint:**

```bash
# In Replit Shell
curl -X POST http://localhost:5000/api/inventory/assign-tracking-categories
```

OR create this endpoint in `/server/routes.ts`:

```typescript
// Add this endpoint to assign tracking categories to existing items
app.post("/api/inventory/fix-old-items", async (req, res) => {
  try {
    const items = await storage.getAllInventory();
    let fixed = 0;
    
    for (const item of items) {
      if (!item.trackingCategory) {
        await storage.updateInventoryItem(item.id, {
          trackingCategory: 'General',
          trackingType: 'exact',
          location: item.location || 'K'
        });
        fixed++;
      }
    }
    
    res.json({ message: `Fixed ${fixed} items` });
  } catch (error) {
    res.status(500).json({ error: error.message });
  }
});
```

Then call: `POST /api/inventory/fix-old-items`

---

### Issue 2: Modal Not Closing

**Problem:** `setShowAddInventoryModal` doesn't exist.

**Fix:** In `/client/src/pages/Inventory.tsx`, find line 74:

**REMOVE THIS LINE:**
```typescript
setShowModal(false);
```

**REPLACE WITH:**
```typescript
setShowAddInventoryModal(false);
```

Do this for ALL mutations (createItemMutation, updateItemMutation, deleteItemMutation, addStockMutation).

---

### Issue 3: Form Validation Too Strict

**Problem:** Button disabled even with all required fields filled.

**Fix:** In `/client/src/components/AddInventoryModal.tsx` around line 265:

**CURRENT CODE:**
```tsx
disabled={isSubmitting || !inventoryData.name || !inventoryData.sku || inventoryData.quantity <= 0 || inventoryData.totalCost <= 0}
```

**CHANGE TO:**
```tsx
disabled={isSubmitting || !inventoryData.name || !inventoryData.sku || inventoryData.quantity <= 0}
```

**Remove:** `|| inventoryData.totalCost <= 0`

---

### Issue 4: Missing Fields in Interface

**Problem:** `AddInventoryData` interface missing new fields.

**Check this file:** `/client/src/components/AddInventoryModal.tsx` line 16

**Should have:**
```typescript
export interface AddInventoryData {
  name: string;
  sku: string;
  category: string;
  trackingCategory: string;  // MUST EXIST
  trackingType: string;       // MUST EXIST
  quantity: number;
  unit: string;
  totalCost: number;
  costPerUnit: number;
  supplier: string;
  minimumStock: number;
  location: string;           // MUST EXIST
  notes: string;
}
```

If missing, ADD these three lines:
- `trackingCategory: string;` (after category)
- `trackingType: string;` (after trackingCategory)
- `location: string;` (after minimumStock)

---

## QUICK FIX CHECKLIST

Run these in order:

1. âœ… **Delete all old inventory** (console command from Step 2)
2. âœ… **Refresh page**
3. âœ… **Try adding ONE test item** with minimal fields
4. âœ… **Check console for errors** (red text)
5. âœ… **Check if item appears** in the list
6. âœ… **If not, check database** (console command from Step 1)

---

## REPORT BACK

After running these steps, tell me:

1. **How many items were in the database?** (from Step 1)
2. **Did the delete work?** (from Step 2)
3. **What errors appear in console?** (from Step 4)
4. **Does test item appear after adding?** (from Step 3)

Then I can give you the EXACT fix!