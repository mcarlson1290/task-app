# Replit Instructions: Fix Staff Data Persistence

**CRITICAL: Staff members are disappearing from Staff Data. This must be fixed to ensure data persistence.**

## Core Requirements
1. Staff data must persist across page reloads
2. Staff data must persist across user sessions
3. Any user who logs in must be automatically added to Staff Data
4. Staff members must NEVER be deleted unless explicitly removed by a manager
5. Angela and other missing staff must be restored

## Step 1: Check Current Data Storage Method

First, identify how staff data is currently being stored:

```javascript
// Look for one of these patterns in your Staff Data component:

// BAD - Data stored in component state only:
const [staffMembers, setStaffMembers] = useState([
  { name: "Robert Carlson", ... }
]);

// GOOD - Data loaded from persistent storage:
const [staffMembers, setStaffMembers] = useState([]);
useEffect(() => {
  const savedStaff = localStorage.getItem('staffData');
  if (savedStaff) {
    setStaffMembers(JSON.parse(savedStaff));
  }
}, []);
```

## Step 2: Implement Proper Data Persistence

### Option A: Using localStorage (Simple)

```javascript
// In your Staff Data component:
const STAFF_STORAGE_KEY = 'growspace_staff_data';

// Load staff data on component mount
const loadStaffData = () => {
  const savedData = localStorage.getItem(STAFF_STORAGE_KEY);
  if (savedData) {
    return JSON.parse(savedData);
  }
  // Return default staff if no saved data
  return [
    {
      id: 'robert-carlson',
      name: 'Robert Carlson',
      email: 'robert@growspace.farm',
      roles: ['Corporate Manager'],
      hireDate: '8/10/2025',
      payRate: 0,
      status: 'Active',
      lastActive: '4 mins ago'
    },
    {
      id: 'angela-carlson',
      name: 'Angela Carlson',
      email: 'angela@growspace.farm',
      roles: ['Advisor'],
      hireDate: '8/10/2025',
      payRate: 0,
      status: 'Active',
      lastActive: '1 day ago'
    }
    // Add other missing staff members here
  ];
};

// Save staff data whenever it changes
const saveStaffData = (staffData) => {
  localStorage.setItem(STAFF_STORAGE_KEY, JSON.stringify(staffData));
};

// In your component:
const [staffMembers, setStaffMembers] = useState(loadStaffData());

// Update the setter to also save
const updateStaffMembers = (newStaff) => {
  setStaffMembers(newStaff);
  saveStaffData(newStaff);
};
```

### Option B: Using a Database Service (Better for production)

```javascript
// Create a staffService.js file:
class StaffService {
  constructor() {
    this.storageKey = 'growspace_staff_data';
    this.initializeDefaultStaff();
  }

  initializeDefaultStaff() {
    const existing = this.getAllStaff();
    if (!existing || existing.length === 0) {
      const defaultStaff = [
        // ... default staff members
      ];
      this.saveAllStaff(defaultStaff);
    }
  }

  getAllStaff() {
    const data = localStorage.getItem(this.storageKey);
    return data ? JSON.parse(data) : [];
  }

  saveAllStaff(staffData) {
    localStorage.setItem(this.storageKey, JSON.stringify(staffData));
  }

  addStaffMember(member) {
    const staff = this.getAllStaff();
    // Check if member already exists
    if (!staff.find(s => s.email === member.email)) {
      staff.push({
        ...member,
        id: member.id || `staff-${Date.now()}`,
        addedDate: new Date().toISOString()
      });
      this.saveAllStaff(staff);
    }
  }

  updateStaffMember(id, updates) {
    const staff = this.getAllStaff();
    const index = staff.findIndex(s => s.id === id);
    if (index !== -1) {
      staff[index] = { ...staff[index], ...updates };
      this.saveAllStaff(staff);
    }
  }
}

export default new StaffService();
```

## Step 3: Auto-Add Users on Login

Find your login/authentication logic and add:

```javascript
// In your login handler or auth context:
const handleUserLogin = async (user) => {
  // ... existing login logic ...
  
  // Auto-add to staff data
  const staffMember = {
    id: user.id || user.email.split('@')[0],
    name: user.displayName || user.name,
    email: user.email,
    roles: user.roles || ['Team Member'],
    hireDate: new Date().toLocaleDateString(),
    payRate: 0,
    status: 'Active',
    lastActive: 'Just now',
    location: user.location || 'Kenosha'
  };
  
  // Add to staff data (won't duplicate if already exists)
  staffService.addStaffMember(staffMember);
};
```

## Step 4: Restore Missing Staff Members

Add this temporary recovery function:

```javascript
const restoreMissingStaff = () => {
  const knownStaff = [
    {
      id: 'angela-carlson',
      name: 'Angela Carlson',
      email: 'angela@growspace.farm',
      roles: ['Advisor', 'Operations', 'Community'],
      hireDate: '8/10/2025',
      status: 'Active'
    },
    {
      id: 'matt-carlson',
      name: 'Matt Carlson',
      email: 'matt@growspace.farm',
      roles: ['Co-Founder', 'Strategic Operator'],
      hireDate: '1/1/2023',
      status: 'Active'
    },
    // Add other known staff members
  ];
  
  const currentStaff = staffService.getAllStaff();
  
  knownStaff.forEach(member => {
    if (!currentStaff.find(s => s.email === member.email)) {
      staffService.addStaffMember(member);
    }
  });
};

// Run once on component mount
useEffect(() => {
  restoreMissingStaff();
}, []);
```

## Step 5: Prevent Accidental Deletions

Update any delete functionality:

```javascript
const handleDeleteStaff = (staffId) => {
  // Add confirmation
  const confirmDelete = window.confirm(
    'Are you sure you want to remove this staff member? This action cannot be undone.'
  );
  
  if (confirmDelete) {
    // Instead of deleting, mark as inactive
    staffService.updateStaffMember(staffId, { 
      status: 'Inactive',
      deactivatedDate: new Date().toISOString()
    });
  }
};
```

## Step 6: Add Data Integrity Checks

```javascript
// Run on app initialization
const validateStaffData = () => {
  const staff = staffService.getAllStaff();
  
  // Check for data corruption
  const validStaff = staff.filter(member => {
    return member && member.name && member.email;
  });
  
  if (validStaff.length !== staff.length) {
    console.warn('Found corrupted staff data, cleaning up...');
    staffService.saveAllStaff(validStaff);
  }
  
  // Log for debugging
  console.log(`Staff Data: ${validStaff.length} members loaded`);
};
```

## Summary

This implementation ensures:
1. ✅ Staff data persists in localStorage/database
2. ✅ Data survives page reloads and session changes
3. ✅ Users are auto-added on login
4. ✅ Missing staff members are restored
5. ✅ Accidental deletions are prevented
6. ✅ Data integrity is maintained

The key is moving from component state storage to persistent storage, and ensuring all staff operations go through a centralized service that maintains data integrity.