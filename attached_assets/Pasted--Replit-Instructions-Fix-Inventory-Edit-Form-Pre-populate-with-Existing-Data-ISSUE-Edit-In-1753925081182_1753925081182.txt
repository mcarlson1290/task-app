# Replit Instructions: Fix Inventory Edit Form - Pre-populate with Existing Data

**ISSUE: Edit Inventory form shows blank fields instead of pre-populating with existing item data**

## Step 1: Find the Edit Button Handler

Look for where the Edit button is clicked and ensure it passes the item data:

```tsx
// In the inventory list/table
<button 
  onClick={() => handleEditItem(item)} 
  className="btn btn-sm btn-primary"
>
  Edit
</button>
```

## Step 2: Fix the handleEditItem Function

```tsx
const handleEditItem = (item) => {
  // Set the form state with ALL item fields including the new SKU
  setFormData({
    id: item.id,
    name: item.name || '',
    sku: item.sku || '', // Include SKU field
    category: item.category || '',
    currentStock: item.currentStock || item.quantity || 0,
    unit: item.unit || '',
    minimumStock: item.minimumStock || 0,
    supplier: item.supplier || '',
    lastRestocked: item.lastRestocked || '',
    costPerUnit: item.costPerUnit || '',
    totalValue: item.totalValue || '',
    // Add any other fields that exist
  });
  
  // Open the edit modal/form
  setIsEditing(true);
  setEditingItemId(item.id);
  setShowModal(true); // or however the modal is shown
};
```

## Step 3: Update the Form State Initialization

Make sure the form component properly uses the state:

```tsx
// In the Edit Inventory modal/form component
const EditInventoryForm = ({ item, onSave, onCancel }) => {
  // Initialize form state with item data OR empty values
  const [formData, setFormData] = useState({
    id: item?.id || '',
    name: item?.name || '',
    sku: item?.sku || '',
    category: item?.category || 'Other Supplies',
    currentStock: item?.currentStock || item?.quantity || 0,
    unit: item?.unit || '',
    minimumStock: item?.minimumStock || 0,
    supplier: item?.supplier || '',
    lastRestocked: item?.lastRestocked || '',
    costPerUnit: item?.costPerUnit || 0,
    // ... other fields
  });

  // Update form when item prop changes
  useEffect(() => {
    if (item) {
      setFormData({
        id: item.id || '',
        name: item.name || '',
        sku: item.sku || '',
        category: item.category || 'Other Supplies',
        currentStock: item.currentStock || item.quantity || 0,
        unit: item.unit || '',
        minimumStock: item.minimumStock || 0,
        supplier: item.supplier || '',
        lastRestocked: item.lastRestocked || '',
        costPerUnit: item.costPerUnit || 0,
      });
    }
  }, [item]);

  return (
    <form>
      <div className="form-group">
        <label>Item Name *</label>
        <input
          type="text"
          value={formData.name}
          onChange={(e) => setFormData({...formData, name: e.target.value})}
          placeholder="e.g., Arugula Seeds"
          required
        />
      </div>

      <div className="form-group">
        <label>SKU (4 characters max) *</label>
        <input
          type="text"
          value={formData.sku}
          onChange={(e) => setFormData({...formData, sku: e.target.value.toUpperCase().slice(0, 4)})}
          placeholder="ARUG"
          maxLength={4}
          required
        />
        <small>4-character code for tray IDs (e.g., ARUG, ROM2, BASL)</small>
      </div>

      {/* ... rest of form fields ... */}
    </form>
  );
};
```

## Step 4: Debug - Add Console Logging

Add temporary logging to see what's happening:

```tsx
const handleEditItem = (item) => {
  console.log('Editing item:', item); // See what data is being passed
  
  // If using a modal, check if the item is being passed correctly
  setCurrentEditItem(item);
  setShowEditModal(true);
};

// In the modal component
useEffect(() => {
  console.log('Modal received item:', item); // See what the modal gets
}, [item]);
```

## Step 5: Check for Data Structure Mismatch

The issue might be that field names don't match. Check if the inventory uses different field names:

```tsx
// Common field name mismatches:
// - quantity vs currentStock
// - costPerUnit vs cost
// - minimumStock vs reorderPoint

const handleEditItem = (item) => {
  // Map fields correctly
  setFormData({
    id: item.id,
    name: item.name || '',
    sku: item.sku || '',
    category: item.category || '',
    currentStock: item.quantity || item.currentStock || 0, // Check both field names
    unit: item.unit || '',
    minimumStock: item.reorderPoint || item.minimumStock || 0, // Check both
    supplier: item.supplier || '',
    lastRestocked: item.lastRestocked || '',
    costPerUnit: item.cost || item.costPerUnit || 0, // Check both
  });
  
  setShowModal(true);
};
```

## Step 6: Alternative - Use a Single State Object

If the form uses a different pattern, it might be using a single edit item state:

```tsx
const [editingItem, setEditingItem] = useState(null);

const handleEditItem = (item) => {
  // Set the entire item object
  setEditingItem({...item}); // Copy the item to avoid mutations
  setShowEditModal(true);
};

// Then in the modal
<EditInventoryModal
  item={editingItem}
  isOpen={showEditModal}
  onClose={() => {
    setEditingItem(null);
    setShowEditModal(false);
  }}
/>
```

## Quick Fix - Force Refresh

If the modal is caching old state, force it to reset:

```tsx
const handleEditItem = (item) => {
  // Close and reopen to force refresh
  setShowModal(false);
  setTimeout(() => {
    setEditingItem(item);
    setShowModal(true);
  }, 50);
};
```

The main issue is likely that the SKU field addition changed how data is passed to the edit form, or there's a mismatch between field names. The form needs to receive and properly initialize with ALL the item's data including the new SKU field.