# Replit Instructions: Fix Default Varieties Not Populating in Task Execution

**ISSUE: Default crop varieties configured in recurring task aren't showing when executing the task**

## Step 1: Check How Defaults Are Stored

In the recurring task configuration, when saving defaults, make sure they're stored properly:

```tsx
// In the recurring task save function
const saveStepConfiguration = (stepData) => {
  // Make sure defaultVarieties is included
  const config = {
    defaultTrayType: stepData.defaultTrayType,
    defaultInstance: stepData.defaultInstance,
    defaultGrowingMedium: stepData.defaultGrowingMedium,
    defaultTotalSlots: stepData.defaultTotalSlots,
    defaultVarieties: stepData.defaultVarieties || [] // This might be missing!
  };
  
  // Save to recurring task
  updateRecurringTask(taskId, { steps: [...steps, config] });
};
```

## Step 2: Pass Defaults to Task Execution

When creating a task instance from a recurring task, make sure defaults are passed:

```tsx
// When executing a recurring task
const executeRecurringTask = (recurringTask) => {
  const taskSteps = recurringTask.steps.map(step => {
    if (step.type === 'create-tray') {
      return {
        ...step,
        defaultVarieties: step.defaultVarieties, // Make sure this is included!
        // other defaults...
      };
    }
    return step;
  });
  
  createTaskInstance(taskSteps);
};
```

## Step 3: Update Create Tray Component to Use Defaults

In the Create Tray component, initialize varieties from defaults:

```tsx
const CreateTrayStep = ({ stepData, onComplete }) => {
  // Initialize varieties from defaults if available
  const [varieties, setVarieties] = useState(() => {
    if (stepData?.defaultVarieties && stepData.defaultVarieties.length > 0) {
      return stepData.defaultVarieties.map(v => ({
        id: Date.now() + Math.random(),
        seedId: v.seedId,
        seedName: v.seedName,
        quantity: v.quantity || 0
      }));
    }
    // If no defaults, start with one empty variety
    return [{
      id: Date.now(),
      seedId: '',
      seedName: '',
      quantity: 0
    }];
  });

  // Also set other defaults
  const [growingMedium, setGrowingMedium] = useState(stepData?.defaultGrowingMedium || '');
  const [totalSlots, setTotalSlots] = useState(stepData?.defaultTotalSlots || 200);
  const [instanceNum, setInstanceNum] = useState(stepData?.defaultInstance || 1);
};
```

## Step 4: Debug Data Flow

Add console logs to trace the issue:

```tsx
// In recurring task configuration save
console.log('Saving defaults:', {
  defaultVarieties: varieties,
  defaultTotalSlots: totalSlots
});

// In task execution
console.log('Step data received:', stepData);
console.log('Default varieties:', stepData?.defaultVarieties);

// In Create Tray component
console.log('Initializing with defaults:', stepData);
```

## Step 5: Check Data Structure

Make sure the variety structure matches between configuration and execution:

```tsx
// Structure when saving defaults
defaultVarieties: [
  {
    seedId: 'ARU',
    seedName: 'Arugula',
    quantity: 50
  }
]

// Should match when loading
varieties: defaultVarieties.map(v => ({
  ...v,
  id: generateId() // Add unique ID for React
}))
```

The issue is likely that the defaultVarieties array isn't being passed from the recurring task configuration to the task execution component.