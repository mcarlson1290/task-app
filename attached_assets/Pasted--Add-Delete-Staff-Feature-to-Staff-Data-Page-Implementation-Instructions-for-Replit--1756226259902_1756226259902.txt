# üóëÔ∏è Add Delete Staff Feature to Staff Data Page

## Implementation Instructions for Replit

### 1. UPDATE BACKEND API - Add Delete Endpoint

In your `server.js` file, add this new endpoint after your existing staff endpoints:

```javascript
// Delete staff member endpoint
app.delete('/api/staff/:id', async (req, res) => {
  try {
    const staffId = parseInt(req.params.id);
    let staff = await readData('staff.json');
    
    // Find the staff member to delete
    const staffToDelete = staff.find(s => s.id === staffId);
    
    if (!staffToDelete) {
      return res.status(404).json({ error: 'Staff member not found' });
    }
    
    // Check if staff has any active tasks (optional safety check)
    const tasks = await readData('tasks.json');
    const hasActiveTasks = tasks.some(task => 
      task.assignedToId === staffId && 
      task.status !== 'completed'
    );
    
    if (hasActiveTasks) {
      return res.status(400).json({ 
        error: 'Cannot delete staff member with active tasks',
        activeTasks: true 
      });
    }
    
    // Remove the staff member
    staff = staff.filter(s => s.id !== staffId);
    
    // Save updated staff list
    await saveData('staff.json', staff);
    
    // Log the deletion for audit purposes
    console.log(`Staff member deleted: ${staffToDelete.fullName} (ID: ${staffId})`);
    
    res.json({ success: true, deleted: staffToDelete });
  } catch (error) {
    console.error('Error deleting staff:', error);
    res.status(500).json({ error: 'Failed to delete staff member' });
  }
});
```

### 2. UPDATE STAFF SERVICE - Add Delete Function

In your staff service file (where you handle API calls), add:

```javascript
// Delete staff member
export const deleteStaffMember = async (staffId) => {
  const response = await fetch(`/api/staff/${staffId}`, {
    method: 'DELETE',
    headers: {
      'Content-Type': 'application/json'
    }
  });
  
  if (!response.ok) {
    const error = await response.json();
    throw new Error(error.error || 'Failed to delete staff member');
  }
  
  return response.json();
};
```

### 3. UPDATE STAFF EDIT MODAL - Add Delete Button

In your `StaffEditModal` component, add the delete functionality:

```javascript
// Add state for deletion confirmation
const [showDeleteConfirm, setShowDeleteConfirm] = useState(false);
const [isDeleting, setIsDeleting] = useState(false);

// Add delete handler function
const handleDelete = async () => {
  if (!showDeleteConfirm) {
    // First click - show confirmation
    setShowDeleteConfirm(true);
    
    // Reset confirmation after 5 seconds
    setTimeout(() => {
      setShowDeleteConfirm(false);
    }, 5000);
    return;
  }
  
  // Second click - actually delete
  setIsDeleting(true);
  
  try {
    await deleteStaffMember(staff.id);
    
    // Show success message
    alert(`${staff.fullName} has been removed from the system.`);
    
    // Close modal and refresh staff list
    onDelete(); // You'll need to pass this from parent
    onClose();
  } catch (error) {
    alert(`Error: ${error.message}`);
    setIsDeleting(false);
    setShowDeleteConfirm(false);
  }
};

// Update the modal actions section
<div className="modal-actions">
  {staff && ( // Only show delete for existing staff, not new ones
    <button 
      type="button" 
      className={`btn-delete ${showDeleteConfirm ? 'confirm' : ''}`}
      onClick={handleDelete}
      disabled={isDeleting}
    >
      {isDeleting ? 'Deleting...' : 
       showDeleteConfirm ? '‚ö†Ô∏è Click again to confirm delete' : 
       'üóëÔ∏è Delete Staff Member'}
    </button>
  )}
  
  <div className="modal-actions-right">
    <button type="submit" className="btn-save" disabled={isDeleting}>
      {staff ? 'Save Changes' : 'Add Staff Member'}
    </button>
    <button type="button" onClick={onClose} className="btn-cancel" disabled={isDeleting}>
      Cancel
    </button>
  </div>
</div>
```

### 4. UPDATE CSS - Style the Delete Button

Add these styles to your staff modal CSS:

```css
/* Update modal actions for three buttons */
.modal-actions {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 24px;
  border-top: 1px solid #e5e7eb;
}

.modal-actions-right {
  display: flex;
  gap: 12px;
}

/* Delete button styling */
.btn-delete {
  background: #dc3545;
  color: white;
  padding: 10px 20px;
  border: none;
  border-radius: 6px;
  cursor: pointer;
  font-weight: 500;
  transition: all 0.2s;
}

.btn-delete:hover {
  background: #c82333;
}

.btn-delete.confirm {
  background: #ff6b6b;
  animation: pulse 0.5s ease-in-out;
}

.btn-delete:disabled {
  opacity: 0.6;
  cursor: not-allowed;
}

@keyframes pulse {
  0% { transform: scale(1); }
  50% { transform: scale(1.05); }
  100% { transform: scale(1); }
}

/* Mobile responsive */
@media (max-width: 768px) {
  .modal-actions {
    flex-direction: column;
    gap: 12px;
  }
  
  .btn-delete {
    width: 100%;
    order: 3; /* Put delete at bottom on mobile */
  }
  
  .modal-actions-right {
    width: 100%;
    flex-direction: column;
  }
  
  .modal-actions-right button {
    width: 100%;
  }
}
```

### 5. UPDATE PARENT COMPONENT - Handle Deletion

In your main Staff Data component, add refresh logic:

```javascript
// Add onDelete handler to pass to modal
const handleStaffDelete = () => {
  // Refresh staff list
  fetchStaff(); // or however you load staff data
  
  // Optionally show a success message
  setShowSuccessMessage('Staff member successfully removed');
  setTimeout(() => setShowSuccessMessage(''), 3000);
};

// Update modal props
{showEditModal && (
  <StaffEditModal
    staff={editingStaff}
    onSave={handleStaffSave}
    onDelete={handleStaffDelete}
    onClose={() => {
      setShowEditModal(false);
      setEditingStaff(null);
    }}
  />
)}
```

### 6. OPTIONAL: Add Safety Features

For extra safety, you can add these enhancements:

```javascript
// Check for dependencies before allowing delete
const checkDependencies = async (staffId) => {
  const checks = {
    hasActiveTasks: false,
    recurringTasksAssigned: false,
    upcomingSchedule: false
  };
  
  // Check active tasks
  const tasks = await fetch('/api/tasks');
  const taskData = await tasks.json();
  checks.hasActiveTasks = taskData.some(t => 
    t.assignedToId === staffId && t.status !== 'completed'
  );
  
  // Check recurring tasks
  const recurring = await fetch('/api/recurring-tasks');
  const recurringData = await recurring.json();
  checks.recurringTasksAssigned = recurringData.some(r => 
    r.assignedRoles.includes(staff.rolesAssigned[0])
  );
  
  return checks;
};

// Show warning if dependencies exist
if (checks.hasActiveTasks || checks.recurringTasksAssigned) {
  const warnings = [];
  if (checks.hasActiveTasks) warnings.push('active tasks');
  if (checks.recurringTasksAssigned) warnings.push('recurring task assignments');
  
  if (!confirm(`Warning: ${staff.fullName} has ${warnings.join(' and ')}. Continue with deletion?`)) {
    return;
  }
}
```

## Testing Instructions

1. **Test with inactive staff first** - Try deleting a staff member who hasn't been assigned any tasks
2. **Test the confirmation flow** - Click delete once, wait for it to reset, verify double-click works
3. **Test with active staff** - Try deleting someone with active tasks (should show warning)
4. **Test UI responsiveness** - Check mobile layout and button positioning
5. **Verify data persistence** - Refresh page and confirm deletion persisted

## Security Considerations

- Only managers should be able to delete staff (check user role)
- Consider soft delete (mark as inactive) instead of hard delete
- Log all deletions for audit trail
- Backup staff.json before implementing

## Implementation Order

1. Add backend endpoint first and test with Postman/curl
2. Add the service function and test in console
3. Update the modal UI
4. Add CSS styling
5. Test end-to-end flow
6. Add safety checks if needed