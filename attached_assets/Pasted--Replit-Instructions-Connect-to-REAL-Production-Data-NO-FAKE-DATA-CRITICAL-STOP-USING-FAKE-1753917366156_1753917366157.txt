# Replit Instructions: Connect to REAL Production Data - NO FAKE DATA

**CRITICAL: STOP USING FAKE TEST DATA. Connect to the ACTUAL data in Production Data page.**

## The Problem
The Tray Split is showing fake test data (TRAY-001, TRAY-002, etc.) instead of the REAL trays from Production Data > Tray Tracking (K071725-MG-BROC-01A, K071725-LG-ROML-02B, etc.)

## Step 1: DELETE ALL Fake Data Sources

Find and DELETE any code that creates fake trays:

```javascript
// DELETE THIS KIND OF CODE:
const mockTrays = [
  { id: 'TRAY-001', crop: 'Lettuce Mix' },
  { id: 'TRAY-002', crop: 'Broccoli Microgreens' },
  // ... any hardcoded test data
];

// DELETE THIS:
const generateTestTrays = () => {
  return Array.from({ length: 5 }, (_, i) => ({
    id: `TRAY-00${i + 1}`,
    // ...
  }));
};

// DELETE THIS:
if (!trays || trays.length === 0) {
  return mockTrays; // NO! Don't return fake data!
}
```

## Step 2: Connect to the REAL Production Data Storage

The real data is stored in localStorage under 'productionTrays'. Use ONLY this:

```javascript
// src/services/trayService.js
export const TrayService = {
  // Get ALL trays from Production Data storage
  getAllTrays() {
    // ONLY use the real production data
    const productionTrays = localStorage.getItem('productionTrays');
    if (!productionTrays) {
      return [];
    }
    
    try {
      const trays = JSON.parse(productionTrays);
      console.log('Loaded REAL trays from Production Data:', trays);
      return trays;
    } catch (error) {
      console.error('Error parsing production trays:', error);
      return [];
    }
  },
  
  // Get active trays for splitting
  getActiveTrays() {
    const allTrays = this.getAllTrays();
    
    // Filter for trays that can be split
    const activeTrays = allTrays.filter(tray => {
      // Must have an ID
      if (!tray.id) return false;
      
      // Skip if already split or harvested
      if (tray.status === 'split' || tray.status === 'harvested') return false;
      
      // Include active/growing trays
      return tray.status === 'active' || 
             tray.status === 'growing' || 
             tray.status === 'germinating' ||
             !tray.status; // Include if no status
    });
    
    console.log('Active trays available for splitting:', activeTrays);
    return activeTrays;
  }
};
```

## Step 3: Update Tray Split Component to Use REAL Data

```javascript
// src/components/checklist/TraySplitStep.jsx
import React, { useState, useEffect } from 'react';
import { TrayService } from '../../services/trayService';

const TraySplitStep = ({ step, value, onChange }) => {
  const [realTrays, setRealTrays] = useState([]);
  const [loading, setLoading] = useState(true);
  
  useEffect(() => {
    // Load REAL trays from Production Data
    const loadRealTrays = () => {
      console.log('Loading trays from Production Data...');
      const trays = TrayService.getActiveTrays();
      
      if (trays.length === 0) {
        console.warn('No trays found in Production Data. Create trays through seeding tasks first!');
      }
      
      setRealTrays(trays);
      setLoading(false);
    };
    
    loadRealTrays();
    
    // Listen for tray updates
    const handleTrayUpdate = () => loadRealTrays();
    window.addEventListener('trayUpdated', handleTrayUpdate);
    window.addEventListener('storage', handleTrayUpdate); // Listen for localStorage changes
    
    return () => {
      window.removeEventListener('trayUpdated', handleTrayUpdate);
      window.removeEventListener('storage', handleTrayUpdate);
    };
  }, []);
  
  if (loading) {
    return <div>Loading trays from Production Data...</div>;
  }
  
  if (realTrays.length === 0) {
    return (
      <div className="no-trays-message">
        <p>No active trays available for splitting.</p>
        <p>Create trays by completing seeding tasks first!</p>
      </div>
    );
  }
  
  // Rest of component using realTrays...
};
```

## Step 4: Connect System Assignment to REAL Equipment Data

```javascript
// src/services/equipmentService.js
export const EquipmentService = {
  // Get all systems from Equipment tab in Production Data
  getAllSystems() {
    const equipment = localStorage.getItem('productionEquipment');
    if (!equipment) {
      return [];
    }
    
    try {
      const systems = JSON.parse(equipment);
      console.log('Loaded REAL equipment from Production Data:', systems);
      return systems;
    } catch (error) {
      console.error('Error parsing equipment data:', error);
      return [];
    }
  },
  
  // Get available systems with capacity
  getAvailableSystems() {
    const allSystems = this.getAllSystems();
    
    // Only return systems with available capacity
    return allSystems.filter(system => {
      const availableCapacity = (system.capacity || 0) - (system.currentLoad || 0);
      return availableCapacity > 0;
    });
  }
};
```

## Step 5: Initialize Production Data with REAL Test Data

If you need test data, put it in the CORRECT place:

```javascript
// src/utils/initializeData.js
export const initializeProductionData = () => {
  // Check if production data exists
  let productionTrays = localStorage.getItem('productionTrays');
  
  if (!productionTrays || JSON.parse(productionTrays).length === 0) {
    // Create REAL test trays that match your format
    const realTestTrays = [
      {
        id: 'K071725-MG-BROC-01A',
        cropType: 'Microgreens',
        cropName: 'Broccoli Microgreens',
        status: 'growing',
        location: 'microgreen-rack-a',
        plants: 200,
        daysInSystem: 1,
        daysToHarvest: 3,
        createdBy: 'John Tech',
        datePlanted: '2025-07-17',
        createdAt: '2025-07-17T08:00:00Z'
      },
      {
        id: 'K071725-LG-ROML-02B',
        cropType: 'Leafy Greens',
        cropName: 'Romaine Lettuce',
        status: 'growing',
        location: 'tower-system-a',
        plants: 24,
        daysInSystem: 7,
        daysToHarvest: 13,
        createdBy: 'Sarah Manager',
        datePlanted: '2025-07-17',
        createdAt: '2025-07-17T09:00:00Z'
      },
      {
        id: 'K071725-MG-ARLL-03C',
        cropType: 'Microgreens',
        cropName: 'Arugula',
        status: 'germinating',
        location: 'blackout-a',
        plants: 150,
        daysInSystem: 1,
        daysToHarvest: 5,
        createdBy: 'John Tech',
        datePlanted: '2025-07-17',
        createdAt: '2025-07-17T10:00:00Z'
      }
    ];
    
    localStorage.setItem('productionTrays', JSON.stringify(realTestTrays));
    console.log('Initialized Production Data with real test trays');
  }
  
  // Initialize equipment if needed
  let productionEquipment = localStorage.getItem('productionEquipment');
  
  if (!productionEquipment || JSON.parse(productionEquipment).length === 0) {
    const realEquipment = [
      {
        id: 'tower-system-a',
        name: 'Tower System A',
        type: 'tower',
        capacity: 50,
        currentLoad: 24
      },
      {
        id: 'microgreen-rack-a',
        name: 'Microgreen Rack A',
        type: 'rack',
        capacity: 500,
        currentLoad: 200
      },
      {
        id: 'blackout-a',
        name: 'Blackout Room A',
        type: 'blackout',
        capacity: 300,
        currentLoad: 150
      }
    ];
    
    localStorage.setItem('productionEquipment', JSON.stringify(realEquipment));
    console.log('Initialized Equipment Data with real systems');
  }
};
```

## Step 6: Verify Data Connection

Add debug logging to verify correct data:

```javascript
// In TraySplitStep component
console.log('=== TRAY SPLIT DATA CHECK ===');
console.log('Production Data trays:', localStorage.getItem('productionTrays'));
console.log('Parsed trays:', TrayService.getAllTrays());
console.log('Active trays for splitting:', TrayService.getActiveTrays());
```

## CRITICAL REMINDERS:

1. **NO FAKE DATA** - Delete all hardcoded test arrays
2. **Use localStorage** - All data comes from 'productionTrays' and 'productionEquipment'
3. **Real IDs only** - K071725-MG-BROC-01A format, not TRAY-001
4. **Production Data is the source** - What you see in Production Data > Tray Tracking is what should appear in splits
5. **Test data goes in localStorage** - If you need test data, put it in the real storage

The Tray Split dropdown should show EXACTLY what's in Production Data > Tray Tracking tab!