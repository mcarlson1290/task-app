# Add Staff API Endpoints to Existing Backend

## Add these staff endpoints to your existing server.js:

```javascript
// Staff endpoints
app.get('/api/staff', async (req, res) => {
  const staff = await readData('staff.json');
  res.json(staff);
});

app.post('/api/staff', async (req, res) => {
  const staff = await readData('staff.json');
  const newStaff = { ...req.body, id: Date.now().toString() };
  staff.push(newStaff);
  await writeData('staff.json', staff);
  res.json(newStaff);
});

app.put('/api/staff/:id', async (req, res) => {
  const staff = await readData('staff.json');
  const index = staff.findIndex(s => s.id === req.params.id);
  if (index !== -1) {
    staff[index] = { ...staff[index], ...req.body };
    await writeData('staff.json', staff);
    res.json(staff[index]);
  } else {
    res.status(404).json({ error: 'Staff member not found' });
  }
});

app.delete('/api/staff/:id', async (req, res) => {
  const staff = await readData('staff.json');
  const filtered = staff.filter(s => s.id !== req.params.id);
  await writeData('staff.json', filtered);
  res.json({ success: true });
});

// Bulk update staff (for corporate managers)
app.put('/api/staff', async (req, res) => {
  const staff = req.body;
  await writeData('staff.json', staff);
  res.json(staff);
});
```

## Update Frontend to Use API

Replace localStorage calls in your staff-related components:

```javascript
// In your staff service or components
const API_URL = 'http://localhost:3001/api';

// Get all staff
export const getStaff = async () => {
  const response = await fetch(`${API_URL}/staff`);
  return response.json();
};

// Add staff member
export const addStaffMember = async (staffData) => {
  const response = await fetch(`${API_URL}/staff`, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(staffData)
  });
  return response.json();
};

// Update staff member
export const updateStaffMember = async (id, updates) => {
  const response = await fetch(`${API_URL}/staff/${id}`, {
    method: 'PUT',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(updates)
  });
  return response.json();
};

// In your App.tsx or authentication handler
const initializeUser = async () => {
  if (isAuthenticated && accounts[0]) {
    const account = accounts[0];
    
    // Check if user exists in database
    const staffData = await getStaff();
    let existingUser = staffData.find(staff => staff.email === account.username);
    
    if (!existingUser) {
      // Create new staff member
      const newStaffMember = {
        name: account.name,
        email: account.username,
        roles: ['General Staff'],
        hireDate: new Date().toISOString().split('T')[0],
        status: 'Active',
        location: 'Kenosha',
        lastActive: new Date().toISOString()
      };
      
      // Special handling for corporate users
      if (account.username === 'robert@growspace.farm' || 
          account.username === 'matt@growspace.farm') {
        newStaffMember.roles = ['Corporate Manager'];
      }
      
      // Add to database
      existingUser = await addStaffMember(newStaffMember);
    }
    
    setCurrentUser(existingUser);
  }
};
```

## Create initial staff.json file

Create `/server/data/staff.json`:

```json
[]
```

This empty array will populate as users log in with Microsoft SSO.