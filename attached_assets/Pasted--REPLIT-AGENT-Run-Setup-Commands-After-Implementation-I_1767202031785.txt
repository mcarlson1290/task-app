# REPLIT AGENT: Run Setup Commands After Implementation

**IMPORTANT: Only run these commands AFTER all the code changes from the inventory package are complete**

---

## Step 1: Create a Setup Script

**Create a new file:** `/server/setup-inventory-categories.ts`

```typescript
import { storage } from './storage';

async function setupInventoryCategories() {
  console.log('ğŸ·ï¸  === INVENTORY CATEGORY SETUP ===');
  console.log('');
  
  try {
    // Part 1: Assign tracking categories to existing inventory
    console.log('ğŸ“¦ Step 1: Assigning tracking categories to inventory items...');
    
    const allItems = await storage.getAllInventory();
    let updateCount = 0;
    
    for (const item of allItems) {
      // Skip if already assigned
      if (item.trackingCategory) {
        console.log(`  â­ï¸  Skipping ${item.name} - already has category: ${item.trackingCategory}`);
        continue;
      }
      
      let category = 'General'; // Default
      const nameLower = item.name.toLowerCase();
      const skuUpper = (item.sku || '').toUpperCase();
      
      // Microgreen items
      if (nameLower.includes('microgreen') || skuUpper.includes('MG')) {
        category = 'Microgreen';
      }
      // Leafy Green items (seeds and supplies)
      else if (
        item.category === 'seeds' ||
        nameLower.includes('lettuce') ||
        nameLower.includes('spinach') ||
        nameLower.includes('arugula') ||
        nameLower.includes('kale') ||
        nameLower.includes('romaine') ||
        nameLower.includes('basil') ||
        nameLower.includes('rockwool') ||
        nameLower.includes('oasis') ||
        nameLower.includes('net cup')
      ) {
        category = 'Leafy Green';
      }
      
      await storage.updateInventoryItem(item.id, {
        trackingCategory: category,
        trackingType: 'exact'
      });
      
      console.log(`  âœ… ${item.name} â†’ ${category}`);
      updateCount++;
    }
    
    console.log('');
    console.log(`ğŸ‰ Step 1 Complete: Assigned tracking categories to ${updateCount} items`);
    console.log('');
    
    // Part 2: Show category distribution
    console.log('ğŸ“Š Step 2: Category Distribution');
    const categoryCounts = {
      'Microgreen': 0,
      'Leafy Green': 0,
      'General': 0
    };
    
    const updatedItems = await storage.getAllInventory();
    updatedItems.forEach(item => {
      if (item.trackingCategory && categoryCounts[item.trackingCategory] !== undefined) {
        categoryCounts[item.trackingCategory]++;
      }
    });
    
    console.log(`  ğŸŒ± Microgreen: ${categoryCounts['Microgreen']} items`);
    console.log(`  ğŸ¥¬ Leafy Green: ${categoryCounts['Leafy Green']} items`);
    console.log(`  ğŸ“¦ General: ${categoryCounts['General']} items`);
    console.log('');
    
    console.log('âœ… === SETUP COMPLETE ===');
    console.log('');
    console.log('Next steps:');
    console.log('1. Go to Tasks page and trigger task generation (or wait for auto-generation)');
    console.log('2. Monthly inventory audit tasks will appear on the 1st of each month');
    console.log('3. Test the new inventory filtering on the Inventory page');
    
  } catch (error) {
    console.error('âŒ Setup failed:', error);
    throw error;
  }
}

// Run the setup
setupInventoryCategories()
  .then(() => {
    console.log('âœ… Setup script completed successfully');
    process.exit(0);
  })
  .catch((error) => {
    console.error('âŒ Setup script failed:', error);
    process.exit(1);
  });
```

---

## Step 2: Add NPM Script to Run Setup

**Edit file:** `/package.json`

**Find the `"scripts"` section and add this line:**

```json
"scripts": {
  "dev": "...",
  "build": "...",
  "setup-inventory": "tsx server/setup-inventory-categories.ts"
}
```

**Full example of what the scripts section should look like:**
```json
"scripts": {
  "dev": "concurrently \"npm run dev:server\" \"npm run dev:client\"",
  "dev:server": "tsx watch server/index.ts",
  "dev:client": "vite",
  "build": "tsc && vite build",
  "setup-inventory": "tsx server/setup-inventory-categories.ts"
}
```

---

## Step 3: Run the Setup Script

**In the Replit Shell, run:**

```bash
npm run setup-inventory
```

---

## Expected Output

You should see something like this:

```
ğŸ·ï¸  === INVENTORY CATEGORY SETUP ===

ğŸ“¦ Step 1: Assigning tracking categories to inventory items...
  âœ… Broccoli Microgreen Seeds â†’ Microgreen
  âœ… Kale Microgreen Seeds â†’ Microgreen
  âœ… Romaine Lettuce Seeds â†’ Leafy Green
  âœ… Spinach Seeds â†’ Leafy Green
  âœ… Rockwool Cubes â†’ Leafy Green
  âœ… Harvest Bags â†’ General
  âœ… Labels â†’ General
  âœ… Nutrient Powder â†’ General

ğŸ‰ Step 1 Complete: Assigned tracking categories to 47 items

ğŸ“Š Step 2: Category Distribution
  ğŸŒ± Microgreen: 12 items
  ğŸ¥¬ Leafy Green: 18 items
  ğŸ“¦ General: 17 items

âœ… === SETUP COMPLETE ===

Next steps:
1. Go to Tasks page and trigger task generation (or wait for auto-generation)
2. Monthly inventory audit tasks will appear on the 1st of each month
3. Test the new inventory filtering on the Inventory page

âœ… Setup script completed successfully
```

---

## Verification

After running the script, verify it worked:

1. **Check the logs** - You should see the output above
2. **Go to Inventory page** - The "Audit Category" filter should now show categorized items
3. **Check database** (optional):
   - Open Replit Database tab
   - Query: `SELECT tracking_category, COUNT(*) FROM inventory_items GROUP BY tracking_category;`
   - Should show counts for each category

---

## Troubleshooting

### If you get "storage is not defined":

Make sure the import path is correct. It might be:
- `import { storage } from './storage';` OR
- `import { storage } from './db/storage';` OR
- `import * as storage from './storage';`

Check where your storage functions are defined.

### If you get "tsx: command not found":

Run: `npm install -D tsx`

Then try again: `npm run setup-inventory`

### If categories look wrong:

You can manually adjust the logic in the script to better match your inventory naming conventions.

---

## Alternative: Run Directly in Node

If the npm script doesn't work, you can also run:

```bash
npx tsx server/setup-inventory-categories.ts
```

---

**After this script runs successfully, you're ready to test!** Go through the Testing Checklist document.