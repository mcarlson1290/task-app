# Replit Instructions: Fix Inventory UI and Recurring Task Inputs

**IMPORTANT: Do not delete any existing tasks, recurring tasks, or user data. Only update the code functionality while preserving all existing data.**

## Issue 1: Fix the Inventory Usage Display
The item name is missing and there are duplicate skip buttons:

```javascript
const InventoryUsageStep = ({ step, onComplete, onSkip }) => {
  const [quantity, setQuantity] = useState(step.defaultQuantity || '');
  const [currentStock, setCurrentStock] = useState(null);
  const [loading, setLoading] = useState(false);
  
  useEffect(() => {
    // Fetch current stock for the item
    fetchCurrentStock(step.inventoryItemId);
  }, [step.inventoryItemId]);
  
  const fetchCurrentStock = async (itemId) => {
    setLoading(true);
    try {
      const response = await fetch(`/api/inventory/${itemId}`);
      const data = await response.json();
      setCurrentStock(data.quantity);
    } catch (error) {
      console.error('Failed to fetch inventory:', error);
      // Use mock data if API fails
      setCurrentStock(0);
    }
    setLoading(false);
  };
  
  const handleSubmit = () => {
    if (quantity && parseFloat(quantity) > 0) {
      onComplete({
        itemId: step.inventoryItemId,
        itemName: step.inventoryItemName,
        quantity: parseFloat(quantity),
        unit: step.inventoryUnit
      });
    }
  };
  
  return (
    <div className="inventory-usage-input">
      <h4>Record Inventory Usage</h4>
      <p className="step-question">{step.text}</p>
      
      {/* Item info box - FIXED to show actual item name */}
      <div className="item-info-box">
        <div className="item-details">
          <strong>Item:</strong> {step.inventoryItemName || 'Unknown Item'}
          <br />
          <span className="stock-info">
            Current stock: {loading ? 'Loading...' : `${currentStock || 0} ${step.inventoryUnit || ''}`}
          </span>
        </div>
      </div>
      
      {/* Amount input section */}
      <div className="amount-section">
        <label>Amount used:</label>
        <div className="quantity-input-group">
          <input
            type="number"
            value={quantity}
            onChange={(e) => setQuantity(e.target.value)}
            placeholder="Enter amount"
            min="0"
            step="0.01"
            className="quantity-field"
            autoFocus
          />
          <span className="unit-label">{step.inventoryUnit || 'units'}</span>
        </div>
        
        {!quantity && (
          <p className="help-text">Enter quantity to continue</p>
        )}
      </div>
      
      {/* Single set of action buttons */}
      <div className="step-actions">
        <button 
          onClick={handleSubmit} 
          disabled={!quantity || parseFloat(quantity) <= 0}
          className="submit-btn primary"
        >
          Record Usage
        </button>
        <button onClick={onSkip} className="skip-btn">
          Skip Step
        </button>
      </div>
    </div>
  );
};
```

## Issue 2: Fix Recurring Task Creator - Add Three Inputs
Update the recurring task step creation modal to show all three inputs when "Inventory Usage" is selected:

```javascript
// In the step type modal/form component
const StepCreationForm = ({ stepType, onAdd, onCancel }) => {
  // State for all step types
  const [stepData, setStepData] = useState({
    text: '',
    // Inventory specific fields
    inventoryItemId: '',
    inventoryItemName: '',
    inventoryUnit: '',
    defaultQuantity: ''
  });
  
  // Inventory items list
  const inventoryItems = [
    { id: 1, name: 'RO Water', unit: 'gallons' },
    { id: 2, name: 'pH Down', unit: 'ml' },
    { id: 3, name: 'pH Up', unit: 'ml' },
    { id: 4, name: 'Nutrients Part A', unit: 'ml' },
    { id: 5, name: 'Nutrients Part B', unit: 'ml' },
    { id: 6, name: 'Rockwool Cubes', unit: 'cubes' },
    { id: 7, name: 'Romaine Seeds', unit: 'seeds' },
    { id: 8, name: 'Buttercrunch Seeds', unit: 'seeds' }
  ];
  
  const handleInventoryItemChange = (e) => {
    const itemId = e.target.value;
    const item = inventoryItems.find(i => i.id === parseInt(itemId));
    
    setStepData({
      ...stepData,
      inventoryItemId: itemId,
      inventoryItemName: item?.name || '',
      inventoryUnit: item?.unit || ''
    });
  };
  
  const handleAdd = () => {
    if (stepType === 'inventory_selection' || stepType === 'inventory_usage') {
      // Validate inventory fields
      if (!stepData.inventoryItemId || !stepData.text) {
        alert('Please select an item and enter step text');
        return;
      }
    }
    
    onAdd({
      type: stepType,
      ...stepData
    });
  };
  
  // Render different forms based on step type
  if (stepType === 'inventory_selection' || stepType === 'inventory_usage') {
    return (
      <div className="step-creation-form">
        <h3>Add Inventory Usage Step</h3>
        
        {/* Input 1: Select inventory item */}
        <div className="form-group">
          <label>1. Select inventory item to track:</label>
          <select
            value={stepData.inventoryItemId}
            onChange={handleInventoryItemChange}
            className="form-select"
          >
            <option value="">Choose an item...</option>
            {inventoryItems.map(item => (
              <option key={item.id} value={item.id}>
                {item.name} ({item.unit})
              </option>
            ))}
          </select>
        </div>
        
        {/* Input 2: Custom text */}
        <div className="form-group">
          <label>2. Enter the question/instruction text:</label>
          <input
            type="text"
            value={stepData.text}
            onChange={(e) => setStepData({...stepData, text: e.target.value})}
            placeholder="e.g., How much water did you use?"
            className="form-input"
          />
          <small>This is what users will see when completing the task</small>
        </div>
        
        {/* Input 3: Default quantity */}
        <div className="form-group">
          <label>3. Default quantity (optional):</label>
          <div className="quantity-input-group">
            <input
              type="number"
              value={stepData.defaultQuantity}
              onChange={(e) => setStepData({...stepData, defaultQuantity: e.target.value})}
              placeholder="e.g., 2.5"
              step="0.1"
              min="0"
              className="form-input quantity-input"
            />
            {stepData.inventoryUnit && (
              <span className="unit-display">{stepData.inventoryUnit}</span>
            )}
          </div>
          <small>Pre-fills this amount to save time</small>
        </div>
        
        <div className="form-actions">
          <button 
            onClick={handleAdd}
            disabled={!stepData.inventoryItemId || !stepData.text}
            className="add-btn"
          >
            Add Step
          </button>
          <button onClick={onCancel} className="cancel-btn">
            Cancel
          </button>
        </div>
      </div>
    );
  }
  
  // Other step types...
  return (
    <div className="step-creation-form">
      {/* Form for other step types */}
    </div>
  );
};
```

## Issue 3: Update Styling
Fix the UI appearance:

```css
/* Inventory usage step styling */
.inventory-usage-input {
  padding: 20px;
  background: #fff;
  border-radius: 8px;
}

.step-question {
  font-size: 16px;
  color: #333;
  margin-bottom: 15px;
}

.item-info-box {
  background: #e3f2fd;
  border: 1px solid #90caf9;
  border-radius: 6px;
  padding: 12px;
  margin-bottom: 20px;
}

.item-details {
  font-size: 14px;
}

.stock-info {
  color: #666;
}

.amount-section {
  margin-bottom: 20px;
}

.quantity-input-group {
  display: flex;
  align-items: center;
  gap: 10px;
  margin-top: 8px;
}

.quantity-field {
  width: 120px;
  padding: 8px;
  border: 1px solid #ddd;
  border-radius: 4px;
  font-size: 16px;
}

.unit-label {
  font-weight: 500;
  color: #666;
}

.help-text {
  color: #999;
  font-size: 14px;
  margin-top: 8px;
}

/* Form styling for recurring task creator */
.step-creation-form {
  padding: 20px;
}

.form-group {
  margin-bottom: 20px;
}

.form-group label {
  display: block;
  font-weight: 600;
  margin-bottom: 8px;
  color: #333;
}

.form-select,
.form-input {
  width: 100%;
  padding: 10px;
  border: 1px solid #ddd;
  border-radius: 4px;
  font-size: 14px;
}

.form-group small {
  display: block;
  margin-top: 5px;
  color: #666;
  font-size: 12px;
}

.quantity-input {
  width: 120px !important;
}

.unit-display {
  font-weight: 500;
  color: #666;
}

/* Remove duplicate skip button */
.step-actions {
  display: flex;
  gap: 10px;
  margin-top: 20px;
}

.submit-btn.primary {
  background: #4CAF50;
  color: white;
  padding: 10px 20px;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  font-weight: 500;
}

.submit-btn:disabled {
  background: #ccc;
  cursor: not-allowed;
}

.skip-btn {
  background: transparent;
  color: #666;
  padding: 10px 20px;
  border: 1px solid #ddd;
  border-radius: 4px;
  cursor: pointer;
}
```

This fixes:
1. Shows the actual inventory item name and stock
2. Removes duplicate skip buttons
3. Adds all three input fields to the recurring task creator
4. Improves the overall UI appearance