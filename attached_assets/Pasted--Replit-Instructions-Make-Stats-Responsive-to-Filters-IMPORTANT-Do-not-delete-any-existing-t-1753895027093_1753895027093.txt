# Replit Instructions: Make Stats Responsive to Filters

**IMPORTANT: Do not delete any existing tasks, recurring tasks, or user data. Only update the code functionality while preserving all existing data.**

## Overview
Update the task statistics to reflect only the currently filtered tasks, not all-time stats.

## Implementation:

### 1. Update Task Summary Component
Pass the filtered tasks to the summary component instead of all tasks:

```javascript
const TaskManager = () => {
  const [allTasks, setAllTasks] = useState([]);
  const [filteredTasks, setFilteredTasks] = useState([]);
  const [activeFilter, setActiveFilter] = useState('all');
  const [dateFilter, setDateFilter] = useState('all'); // today, week, month, all
  
  // Apply filters
  useEffect(() => {
    let filtered = [...allTasks];
    
    // Apply status filter
    if (activeFilter !== 'all') {
      filtered = filtered.filter(task => {
        switch (activeFilter) {
          case 'completed-late':
            return isTaskLate(task);
          case 'overdue':
            return task.status !== 'completed' && new Date(task.dueDate) < new Date();
          default:
            return task.status === activeFilter;
        }
      });
    }
    
    // Apply date filter
    if (dateFilter !== 'all') {
      const now = new Date();
      filtered = filtered.filter(task => {
        const taskDate = new Date(task.dueDate);
        switch (dateFilter) {
          case 'today':
            return isSameDay(taskDate, now);
          case 'week':
            return isWithinDays(taskDate, now, 7);
          case 'month':
            return isWithinDays(taskDate, now, 30);
          default:
            return true;
        }
      });
    }
    
    setFilteredTasks(filtered);
  }, [allTasks, activeFilter, dateFilter]);
  
  return (
    <div className="task-manager">
      {/* Pass FILTERED tasks to summary, not all tasks */}
      <TaskSummary 
        tasks={filteredTasks} 
        activeFilter={activeFilter}
        dateFilter={dateFilter}
      />
      
      {/* Filters */}
      <div className="filters">
        {/* ... filter buttons ... */}
      </div>
      
      {/* Task list */}
      <div className="task-list">
        {filteredTasks.map(task => (
          <TaskCard key={task.id} task={task} />
        ))}
      </div>
    </div>
  );
};
```

### 2. Update Summary Component with Context
Show what's being displayed:

```javascript
const TaskSummary = ({ tasks, activeFilter, dateFilter }) => {
  const completedTasks = tasks.filter(t => t.status === 'completed');
  const lateTasks = completedTasks.filter(t => isTaskLate(t));
  const onTimeTasks = completedTasks.length - lateTasks.length;
  const pendingTasks = tasks.filter(t => t.status === 'pending');
  const inProgressTasks = tasks.filter(t => t.status === 'in-progress');
  
  // Calculate completion rate only if there are completed tasks
  const completionRate = completedTasks.length > 0 
    ? Math.round((onTimeTasks / completedTasks.length) * 100) 
    : 0;
  
  // Get filter description
  const getFilterDescription = () => {
    let desc = '';
    if (dateFilter !== 'all') {
      desc += dateFilter.charAt(0).toUpperCase() + dateFilter.slice(1) + ' ';
    }
    if (activeFilter !== 'all') {
      desc += activeFilter.replace('-', ' ').replace(/\b\w/g, l => l.toUpperCase());
    } else {
      desc += 'All Tasks';
    }
    return desc;
  };
  
  return (
    <div className="task-summary">
      <div className="summary-header">
        <h3>Task Statistics</h3>
        <span className="filter-context">{getFilterDescription()}</span>
      </div>
      
      <div className="summary-stats">
        <div className="summary-item">
          <span className="summary-label">Total:</span>
          <span className="summary-value">{tasks.length}</span>
        </div>
        
        <div className="summary-item">
          <span className="summary-label">Pending:</span>
          <span className="summary-value pending">{pendingTasks.length}</span>
        </div>
        
        <div className="summary-item">
          <span className="summary-label">In Progress:</span>
          <span className="summary-value in-progress">{inProgressTasks.length}</span>
        </div>
        
        <div className="summary-item">
          <span className="summary-label">Completed:</span>
          <span className="summary-value completed">
            {completedTasks.length}
            {completedTasks.length > 0 && (
              <span className="completion-breakdown">
                ({onTimeTasks} on time, {lateTasks.length} late)
              </span>
            )}
          </span>
        </div>
        
        {completedTasks.length > 0 && (
          <div className="summary-item">
            <span className="summary-label">On-Time Rate:</span>
            <span className={`summary-value ${completionRate >= 80 ? 'good' : completionRate >= 60 ? 'warning' : 'poor'}`}>
              {completionRate}%
            </span>
          </div>
        )}
      </div>
      
      {tasks.length === 0 && (
        <div className="no-tasks-message">
          No tasks match the current filters
        </div>
      )}
    </div>
  );
};
```

### 3. Add CSS for Better Visual Context
```css
.task-summary {
  background: white;
  padding: 20px;
  border-radius: 8px;
  margin-bottom: 20px;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
}

.summary-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 16px;
}

.filter-context {
  color: #6b7280;
  font-size: 14px;
  font-weight: 500;
}

.summary-stats {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
  gap: 16px;
}

.summary-item {
  display: flex;
  flex-direction: column;
}

.summary-label {
  color: #6b7280;
  font-size: 12px;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  margin-bottom: 4px;
}

.summary-value {
  font-size: 24px;
  font-weight: 600;
  color: #1f2937;
}

.completion-breakdown {
  display: block;
  font-size: 12px;
  font-weight: 400;
  color: #6b7280;
  margin-top: 2px;
}

.summary-value.good {
  color: #059669;
}

.summary-value.warning {
  color: #f59e0b;
}

.summary-value.poor {
  color: #dc2626;
}

.no-tasks-message {
  text-align: center;
  color: #9ca3af;
  padding: 20px;
  font-style: italic;
}
```

### 4. Add Time Range Quick Filters
Add common time range filters for better analysis:

```javascript
// Quick filter buttons
<div className="time-filters">
  <button 
    className={dateFilter === 'today' ? 'active' : ''}
    onClick={() => setDateFilter('today')}
  >
    Today
  </button>
  <button 
    className={dateFilter === 'week' ? 'active' : ''}
    onClick={() => setDateFilter('week')}
  >
    This Week
  </button>
  <button 
    className={dateFilter === 'month' ? 'active' : ''}
    onClick={() => setDateFilter('month')}
  >
    This Month
  </button>
  <button 
    className={dateFilter === 'all' ? 'active' : ''}
    onClick={() => setDateFilter('all')}
  >
    All Time
  </button>
</div>
```

## Expected Behavior:
1. Stats update immediately when filters change
2. Shows context like "Today Completed Tasks" or "This Week All Tasks"
3. Only counts tasks that match current filters
4. Shows "No tasks match" message when filtered to empty
5. On-time rate only calculated from visible completed tasks
6. Color-coded performance indicators (green >80%, amber 60-80%, red <60%)

This makes the stats much more useful for daily operations and performance tracking!