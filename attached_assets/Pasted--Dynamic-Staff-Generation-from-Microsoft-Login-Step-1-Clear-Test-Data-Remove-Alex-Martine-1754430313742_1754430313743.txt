# Dynamic Staff Generation from Microsoft Login

## Step 1: Clear Test Data

Remove Alex Martinez and Sarah Johnson from your mock data:

```tsx
// In your staff data initialization or mockData.ts
// REMOVE or clear this:
const mockStaff = [
  // Remove all test users
];

// Or if using localStorage
localStorage.setItem('staffData', JSON.stringify([]));
```

## Step 2: Auto-Create Staff Entry on First Login

Update your Microsoft authentication handler in `App.tsx`:

```tsx
// When user successfully logs in with Microsoft
const initializeUser = async () => {
  if (isAuthenticated && accounts[0]) {
    const account = accounts[0];
    
    // Verify email domain
    if (!isAuthorizedEmail(account.username)) {
      alert('Access denied. Only @growspace.farm emails are allowed.');
      await instance.logoutPopup();
      return;
    }

    // Check if user already exists in staff data
    let staffData = JSON.parse(localStorage.getItem('staffData') || '[]');
    let existingUser = staffData.find(staff => staff.email === account.username);
    
    if (!existingUser) {
      // Create new staff entry for first-time login
      const newStaffMember = {
        id: account.localAccountId || account.homeAccountId,
        name: account.name,
        email: account.username,
        phone: '', // To be filled by manager
        roles: ['General Staff'], // Default role
        hireDate: new Date().toISOString().split('T')[0],
        payRate: 0, // To be set by manager
        trainingCompleted: [],
        status: 'Active',
        lastActive: new Date().toISOString(),
        microsoftId: account.localAccountId,
        location: 'Kenosha',
        department: '', // To be filled by manager
        notes: '' // Manager notes
      };
      
      // Add to staff data
      staffData.push(newStaffMember);
      localStorage.setItem('staffData', JSON.stringify(staffData));
      existingUser = newStaffMember;
    } else {
      // Update last active time
      existingUser.lastActive = new Date().toISOString();
      const index = staffData.findIndex(s => s.id === existingUser.id);
      staffData[index] = existingUser;
      localStorage.setItem('staffData', JSON.stringify(staffData));
    }

    // Create user object for context
    const user = {
      id: existingUser.id,
      name: existingUser.name,
      email: existingUser.email,
      role: determineUserRole(existingUser),
      isManager: existingUser.roles.includes('Manager') || existingUser.roles.includes('Corporate Manager'),
      isCorporateManager: existingUser.roles.includes('Corporate Manager'),
      location: existingUser.location || 'Kenosha'
    };

    setCurrentUser(user);
  }
};

// Helper to determine primary role
const determineUserRole = (staffMember) => {
  if (staffMember.roles.includes('Corporate Manager')) return 'Corporate';
  if (staffMember.roles.includes('Manager')) return 'Manager';
  return 'Staff';
};
```

## Step 3: Update Staff Data Page

Make the staff list dynamic and allow role editing:

```tsx
const StaffData = () => {
  const [staff, setStaff] = useState([]);
  const currentUser = useContext(UserContext);
  const isCorporate = currentUser?.role === 'Corporate';
  const isManager = currentUser?.role === 'Manager' || isCorporate;

  useEffect(() => {
    // Load staff from localStorage
    const staffData = JSON.parse(localStorage.getItem('staffData') || '[]');
    setStaff(staffData);
  }, []);

  const updateStaffRole = (staffId, newRoles) => {
    const updatedStaff = staff.map(member => {
      if (member.id === staffId) {
        return { ...member, roles: newRoles };
      }
      return member;
    });
    
    setStaff(updatedStaff);
    localStorage.setItem('staffData', JSON.stringify(updatedStaff));
  };

  // Role options based on current user's permissions
  const getRoleOptions = () => {
    const baseRoles = [
      'General Staff',
      'Seeding Tech',
      'Harvest Tech',
      'Packing',
      'Cleaning Crew',
      'Equipment Tech'
    ];
    
    if (isManager) {
      baseRoles.push('Manager');
    }
    
    if (isCorporate) {
      baseRoles.push('Corporate Manager');
    }
    
    return baseRoles;
  };
```

## Step 4: Role Editor Component

Add a role editor in the staff edit modal:

```tsx
const RoleEditor = ({ staffMember, onUpdate, currentUserRole }) => {
  const [selectedRoles, setSelectedRoles] = useState(staffMember.roles || []);
  const availableRoles = getRoleOptions(currentUserRole);

  const handleRoleToggle = (role) => {
    if (selectedRoles.includes(role)) {
      setSelectedRoles(selectedRoles.filter(r => r !== role));
    } else {
      setSelectedRoles([...selectedRoles, role]);
    }
  };

  const canAssignRole = (role) => {
    // Corporate can assign any role
    if (currentUserRole === 'Corporate') return true;
    
    // Managers can assign all except Corporate Manager
    if (currentUserRole === 'Manager' && role !== 'Corporate Manager') return true;
    
    // Staff can't assign roles
    return false;
  };

  return (
    <div className="role-editor">
      <h3>Assign Roles</h3>
      <div className="role-checkboxes">
        {availableRoles.map(role => (
          <label key={role} className="role-checkbox">
            <input
              type="checkbox"
              checked={selectedRoles.includes(role)}
              onChange={() => handleRoleToggle(role)}
              disabled={!canAssignRole(role)}
            />
            <span>{role}</span>
          </label>
        ))}
      </div>
      <button onClick={() => onUpdate(selectedRoles)}>
        Save Roles
      </button>
    </div>
  );
};
```

## Step 5: Clean Initial State

When the app first loads, ensure clean state:

```tsx
// In your app initialization
const initializeApp = () => {
  // Check if this is first run
  const isFirstRun = !localStorage.getItem('appInitialized');
  
  if (isFirstRun) {
    // Clear any test data
    localStorage.setItem('staffData', JSON.stringify([]));
    localStorage.setItem('appInitialized', 'true');
  }
};
```

## Step 6: Permission Rules

Implement role assignment permissions:

```tsx
const rolePermissions = {
  'Corporate': {
    canAssign: ['Corporate Manager', 'Manager', 'All Staff Roles'],
    canEdit: ['All Staff Data'],
    canView: ['All Pages']
  },
  'Manager': {
    canAssign: ['Manager', 'All Staff Roles except Corporate'],
    canEdit: ['Staff Data except Corporate users'],
    canView: ['All Pages except some Corporate features']
  },
  'Staff': {
    canAssign: [],
    canEdit: ['Own Profile Only'],
    canView: ['Limited Pages']
  }
};
```

## Result:

1. **Empty staff list initially** - No test users
2. **Auto-populate on login** - Each Microsoft login creates a staff entry
3. **Role assignment hierarchy**:
   - Corporate → Can assign any role including Corporate Manager
   - Manager → Can assign Manager and below
   - Staff → Can't assign roles
4. **Managers can edit** additional fields like pay rate, department, etc.

This creates a clean, dynamic system where your staff data grows organically as people log in!