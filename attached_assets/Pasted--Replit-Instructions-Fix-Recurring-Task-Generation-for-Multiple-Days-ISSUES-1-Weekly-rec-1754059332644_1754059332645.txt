# Replit Instructions: Fix Recurring Task Generation for Multiple Days

**ISSUES:**
1. Weekly recurring tasks only generating one task instead of multiple future tasks
2. Not generating a task for today (Friday) when Friday is selected
3. Need to generate tasks into the future but keep them editable until started

## Step 1: Fix Task Generation to Create Multiple Future Tasks

Find the recurring task generation logic and update it to generate multiple days:

```tsx
const generateTasksFromRecurringTask = (recurringTask) => {
  console.log('Generating tasks for recurring task:', recurringTask);
  
  const tasks = [];
  const today = new Date();
  today.setHours(0, 0, 0, 0); // Reset to midnight
  
  // Determine how many days ahead to generate
  const daysToGenerate = recurringTask.frequency === 'monthly' ? 60 : 30; // Generate 30-60 days ahead
  
  // For each day in the range
  for (let i = 0; i <= daysToGenerate; i++) {
    const checkDate = new Date(today);
    checkDate.setDate(today.getDate() + i);
    
    // Check if this day should have a task
    if (shouldGenerateTaskForDate(recurringTask, checkDate)) {
      // Check if task already exists for this date
      const existingTask = findExistingTask(recurringTask.id, checkDate);
      
      if (!existingTask) {
        const newTask = createTaskFromRecurring(recurringTask, checkDate);
        tasks.push(newTask);
      }
    }
  }
  
  console.log(`Generated ${tasks.length} tasks for recurring task ${recurringTask.name}`);
  return tasks;
};
```

## Step 2: Fix Day-of-Week Checking

Ensure the day checking logic works correctly:

```tsx
const shouldGenerateTaskForDate = (recurringTask, date) => {
  const { frequency, selectedDays } = recurringTask;
  
  if (frequency === 'weekly' && selectedDays && selectedDays.length > 0) {
    const dayNames = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
    const dayOfWeek = dayNames[date.getDay()];
    
    console.log(`Checking ${date.toDateString()} (${dayOfWeek}) against selected days:`, selectedDays);
    
    return selectedDays.includes(dayOfWeek);
  }
  
  if (frequency === 'bi-weekly') {
    const dayOfMonth = date.getDate();
    return dayOfMonth === 1 || dayOfMonth === 15;
  }
  
  if (frequency === 'monthly') {
    return date.getDate() === 1;
  }
  
  return false;
};
```

## Step 3: Create Task with Proper Structure

```tsx
const createTaskFromRecurring = (recurringTask, dueDate) => {
  return {
    id: `task_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,
    recurringTaskId: recurringTask.id,
    name: recurringTask.name,
    description: recurringTask.description,
    priority: recurringTask.priority || 'medium',
    dueDate: dueDate.toISOString(),
    createdAt: new Date().toISOString(),
    status: 'pending',
    checklist: recurringTask.checklist || [],
    estimatedDuration: recurringTask.estimatedDuration || 30,
    assignedTo: recurringTask.assignedTo || [],
    category: recurringTask.category,
    location: recurringTask.location,
    // Important: track that this is from a recurring task and can be updated
    isRecurringInstance: true,
    lastSyncedAt: new Date().toISOString()
  };
};
```

## Step 4: Implement Update Logic for Pending Tasks

When a recurring task is edited, update all pending instances:

```tsx
const updateRecurringTask = async (recurringTaskId, updates) => {
  console.log('Updating recurring task:', recurringTaskId, updates);
  
  // Update the recurring task template
  const recurringTasks = JSON.parse(localStorage.getItem('recurringTasks') || '[]');
  const index = recurringTasks.findIndex(rt => rt.id === recurringTaskId);
  
  if (index !== -1) {
    recurringTasks[index] = { ...recurringTasks[index], ...updates };
    localStorage.setItem('recurringTasks', JSON.stringify(recurringTasks));
    
    // Update all pending instances
    updatePendingInstances(recurringTaskId, updates);
    
    // Regenerate tasks if schedule changed
    if (updates.selectedDays || updates.frequency) {
      regenerateTasksForRecurring(recurringTasks[index]);
    }
  }
};

const updatePendingInstances = (recurringTaskId, updates) => {
  const tasks = JSON.parse(localStorage.getItem('tasks') || '[]');
  
  const updatedTasks = tasks.map(task => {
    // Only update if it's from this recurring task AND not started
    if (task.recurringTaskId === recurringTaskId && 
        task.status === 'pending' && 
        !task.startedAt) {
      console.log('Updating pending task instance:', task.id);
      
      return {
        ...task,
        name: updates.name || task.name,
        description: updates.description || task.description,
        checklist: updates.checklist || task.checklist,
        priority: updates.priority || task.priority,
        estimatedDuration: updates.estimatedDuration || task.estimatedDuration,
        lastSyncedAt: new Date().toISOString()
      };
    }
    return task;
  });
  
  localStorage.setItem('tasks', JSON.stringify(updatedTasks));
  
  // Trigger UI update
  window.dispatchEvent(new CustomEvent('tasksUpdated'));
};
```

## Step 5: Handle Schedule Changes

When days are added/removed, regenerate appropriately:

```tsx
const regenerateTasksForRecurring = (recurringTask) => {
  const tasks = JSON.parse(localStorage.getItem('tasks') || '[]');
  const today = new Date();
  today.setHours(0, 0, 0, 0);
  
  // Remove future pending tasks that no longer match schedule
  const tasksToKeep = tasks.filter(task => {
    if (task.recurringTaskId !== recurringTask.id) return true;
    if (task.status !== 'pending') return true;
    if (task.startedAt) return true;
    
    const taskDate = new Date(task.dueDate);
    if (taskDate < today) return true; // Keep past tasks
    
    // Check if this date should still have a task
    return shouldGenerateTaskForDate(recurringTask, taskDate);
  });
  
  // Generate new tasks for newly selected days
  const newTasks = generateTasksFromRecurringTask(recurringTask);
  
  // Combine and save
  const allTasks = [...tasksToKeep, ...newTasks];
  localStorage.setItem('tasks', JSON.stringify(allTasks));
  
  window.dispatchEvent(new CustomEvent('tasksUpdated'));
};
```

## Step 6: Trigger Generation on Create/Update

Ensure tasks are generated when recurring task is created:

```tsx
const handleCreateRecurringTask = (recurringTaskData) => {
  // Save the recurring task
  const recurringTasks = JSON.parse(localStorage.getItem('recurringTasks') || '[]');
  const newRecurringTask = {
    ...recurringTaskData,
    id: `recurring_${Date.now()}`,
    createdAt: new Date().toISOString(),
    isActive: true
  };
  
  recurringTasks.push(newRecurringTask);
  localStorage.setItem('recurringTasks', JSON.stringify(recurringTasks));
  
  // Immediately generate task instances
  const generatedTasks = generateTasksFromRecurringTask(newRecurringTask);
  
  // Save generated tasks
  const existingTasks = JSON.parse(localStorage.getItem('tasks') || '[]');
  const allTasks = [...existingTasks, ...generatedTasks];
  localStorage.setItem('tasks', JSON.stringify(allTasks));
  
  console.log(`Created recurring task and generated ${generatedTasks.length} task instances`);
  
  // Refresh UI
  window.location.reload(); // Or better: trigger state update
};
```

## Step 7: Add Debug Logging

Add logging to see what's happening:

```tsx
// In the weekly task creation
console.log('Creating weekly recurring task:', {
  selectedDays: recurringTask.selectedDays,
  today: new Date().toLocaleDateString(),
  todayDayName: ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'][new Date().getDay()]
});

// Log each day being checked
for (let i = 0; i <= 30; i++) {
  const date = new Date();
  date.setDate(date.getDate() + i);
  const dayName = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'][date.getDay()];
  const shouldGenerate = recurringTask.selectedDays.includes(dayName);
  
  console.log(`Day ${i}: ${date.toDateString()} (${dayName}) - Generate: ${shouldGenerate}`);
}
```

## Summary

The key fixes:
1. **Generate multiple days ahead** - Not just one task
2. **Include today** - If today matches selected days, create a task
3. **Keep pending tasks synced** - When recurring task is edited, update all pending instances
4. **Only update non-started tasks** - Once started, tasks become independent
5. **Regenerate on schedule change** - Add/remove tasks when days are changed

This ensures your Mon-Fri recurring task creates tasks for today (Friday) and all weekdays for the next 30 days!