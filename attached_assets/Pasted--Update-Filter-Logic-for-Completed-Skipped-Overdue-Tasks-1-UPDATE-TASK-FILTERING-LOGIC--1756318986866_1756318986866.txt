# üìÖ Update Filter Logic for Completed/Skipped Overdue Tasks

## 1. UPDATE TASK FILTERING LOGIC

Modify your task filtering to check completion/skip date:

```javascript
// In your Tasks page component
const filterTasksByDate = (tasks, selectedDate) => {
  const today = new Date().toISOString().split('T')[0];
  
  return tasks.filter(task => {
    // For completed or skipped tasks, only show on their completion date
    if (task.status === 'completed' || task.status === 'skipped') {
      // Check if task has a completedAt or skippedAt date
      const actionDate = task.completedAt || task.skippedAt;
      if (actionDate) {
        // Only show on the date it was completed/skipped
        return actionDate.split('T')[0] === selectedDate;
      }
      // If no action date recorded, fall back to due date
      return task.dueDate === selectedDate;
    }
    
    // For pending/in-progress tasks
    if (task.status === 'pending' || task.status === 'in_progress') {
      // If task is overdue, show it on today
      if (task.dueDate < today && selectedDate === today) {
        return true;
      }
      // Otherwise show on its due date
      return task.dueDate === selectedDate;
    }
    
    // Default: show on due date
    return task.dueDate === selectedDate;
  });
};
```

## 2. UPDATE TASK STATUS ACTIONS TO RECORD DATES

When marking tasks as completed or skipped, record the timestamp:

```javascript
// Update your complete task function
const completeTask = async (taskId) => {
  try {
    const now = new Date().toISOString();
    
    const response = await fetch(`/api/tasks/${taskId}`, {
      method: 'PATCH',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        status: 'completed',
        completedAt: now,
        completedBy: currentUser?.id
      })
    });
    
    if (response.ok) {
      // Refresh tasks
      loadTasks();
    }
  } catch (error) {
    console.error('Error completing task:', error);
  }
};

// Update your skip task function
const skipTask = async (taskId, reason = '') => {
  try {
    const now = new Date().toISOString();
    
    const response = await fetch(`/api/tasks/${taskId}`, {
      method: 'PATCH',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        status: 'skipped',
        skippedAt: now,
        skippedBy: currentUser?.id,
        skipReason: reason
      })
    });
    
    if (response.ok) {
      // Refresh tasks
      loadTasks();
    }
  } catch (error) {
    console.error('Error skipping task:', error);
  }
};
```

## 3. UPDATE BACKEND TASK SCHEMA

Ensure your task model includes these fields:

```javascript
// In your backend task handling
const taskSchema = {
  id: Number,
  title: String,
  status: String, // 'pending', 'in_progress', 'completed', 'skipped'
  dueDate: String, // YYYY-MM-DD format
  completedAt: String, // ISO timestamp when completed
  completedBy: Number, // User ID who completed
  skippedAt: String, // ISO timestamp when skipped
  skippedBy: Number, // User ID who skipped
  skipReason: String, // Optional reason for skipping
  // ... other fields
};
```

## 4. UPDATE THE TASK DISPLAY LOGIC

Update how overdue tasks are displayed:

```javascript
// In your TaskCard component
const TaskCard = ({ task, selectedDate }) => {
  const today = new Date().toISOString().split('T')[0];
  const isOverdue = task.dueDate < today && task.status === 'pending';
  
  // Show overdue indicator only for pending tasks
  const showOverdueIndicator = isOverdue && selectedDate === today;
  
  // For completed/skipped tasks, show the action date
  const getTaskDateDisplay = () => {
    if (task.status === 'completed' && task.completedAt) {
      const completedDate = new Date(task.completedAt);
      return `Completed ${completedDate.toLocaleDateString()}`;
    }
    
    if (task.status === 'skipped' && task.skippedAt) {
      const skippedDate = new Date(task.skippedAt);
      return `Skipped ${skippedDate.toLocaleDateString()}`;
    }
    
    if (isOverdue) {
      const overdueDays = Math.floor(
        (new Date(today) - new Date(task.dueDate)) / (1000 * 60 * 60 * 24)
      );
      return `${overdueDays} day${overdueDays === 1 ? '' : 's'} overdue`;
    }
    
    return `Due ${new Date(task.dueDate).toLocaleDateString()}`;
  };
  
  return (
    <div className={`task-card ${task.status}`}>
      {showOverdueIndicator && (
        <div className="overdue-indicator">
          ‚ö†Ô∏è OVERDUE - Task is past due
        </div>
      )}
      
      {/* Task content */}
      
      <div className="task-date-info">
        {getTaskDateDisplay()}
      </div>
    </div>
  );
};
```

## 5. ADD MIGRATION FOR EXISTING COMPLETED TASKS

If you have existing completed tasks without completion dates:

```javascript
// Migration script to add completion dates to existing tasks
const addCompletionDates = async () => {
  const tasks = await readData('tasks.json');
  
  const updatedTasks = tasks.map(task => {
    // If completed but no completedAt date, use due date as fallback
    if (task.status === 'completed' && !task.completedAt) {
      return {
        ...task,
        completedAt: task.dueDate + 'T23:59:59Z' // End of due date
      };
    }
    
    // If skipped but no skippedAt date, use due date as fallback
    if (task.status === 'skipped' && !task.skippedAt) {
      return {
        ...task,
        skippedAt: task.dueDate + 'T23:59:59Z'
      };
    }
    
    return task;
  });
  
  await saveData('tasks.json', updatedTasks);
};
```

## 6. VISUAL DIFFERENTIATION FOR TASK STATES

Add CSS to clearly show task states:

```css
/* Completed tasks */
.task-card.completed {
  opacity: 0.7;
  background: #f0fdf4;
  border-left: 4px solid #22c55e;
}

/* Skipped tasks */
.task-card.skipped {
  opacity: 0.6;
  background: #fef3c7;
  border-left: 4px solid #f59e0b;
}

/* Overdue indicator for pending tasks */
.overdue-indicator {
  background: #fee2e2;
  color: #dc2626;
  padding: 4px 8px;
  font-size: 11px;
  font-weight: 600;
  border-radius: 4px;
  margin-bottom: 8px;
}

/* Task date info */
.task-date-info {
  font-size: 12px;
  color: #6b7280;
  margin-top: 8px;
}
```

## Summary of Behavior:

- **Pending overdue tasks**: Show on today's date with overdue indicator
- **Completed overdue tasks**: Only show on the date they were completed
- **Skipped overdue tasks**: Only show on the date they were skipped
- **Regular tasks**: Show on their due date as normal

This keeps your today view clean by removing handled overdue tasks while preserving the historical record of when tasks were actually completed.