# Fix Overdue Task Logic - 8:30 PM Cutoff

Tasks should only be marked as overdue if:
1. The due date is in the past (previous days), OR
2. The due date is today AND it's after 8:30 PM

Currently, tasks are being marked overdue incorrectly. Fix this logic:

## 1. Update the Overdue Check Function

Find where the `isOverdue` flag is being set and update it:

```javascript
const checkIfOverdue = (taskDate) => {
  if (!taskDate) return false;
  
  const now = new Date();
  const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
  
  // Parse the task date (YYYY-MM-DD format)
  const [year, month, day] = taskDate.split('-');
  const dueDate = new Date(parseInt(year), parseInt(month) - 1, parseInt(day));
  
  // If due date is before today, it's overdue
  if (dueDate < today) {
    return true;
  }
  
  // If due date is today, check if it's after 8:30 PM
  if (dueDate.getTime() === today.getTime()) {
    const currentHour = now.getHours();
    const currentMinute = now.getMinutes();
    
    // Check if it's after 8:30 PM (20:30 in 24-hour format)
    if (currentHour > 20 || (currentHour === 20 && currentMinute >= 30)) {
      return true;
    }
  }
  
  // Otherwise, not overdue
  return false;
};
```

## 2. Update Task Creation/Update Logic

When creating or updating tasks, use this function:

```javascript
const handleAddTask = (newTask) => {
  const taskToAdd = {
    id: Date.now(),
    ...newTask,
    status: 'pending',
    progress: 0,
    checklistItems: 0,
    checklistCompleted: 0,
    isOverdue: checkIfOverdue(newTask.completionDate) // Use the function here
  };
  
  setTasks(prevTasks => [...prevTasks, taskToAdd]);
  setShowAddTaskModal(false);
};
```

## 3. Add Periodic Overdue Check

Since the overdue status can change throughout the day, add a periodic check:

```javascript
// In the Tasks component, add this useEffect
useEffect(() => {
  // Check overdue status every minute
  const checkOverdueStatus = () => {
    setTasks(prevTasks => 
      prevTasks.map(task => ({
        ...task,
        isOverdue: task.status !== 'completed' ? checkIfOverdue(task.completionDate) : false
      }))
    );
  };
  
  // Check immediately on mount
  checkOverdueStatus();
  
  // Set up interval to check every minute
  const interval = setInterval(checkOverdueStatus, 60000); // 60 seconds
  
  return () => clearInterval(interval);
}, []);
```

## 4. Update Mock Data Generation

If you have mock tasks, update their overdue status:

```javascript
const generateMockTasks = () => {
  const today = new Date().toISOString().split('T')[0];
  const yesterday = new Date(Date.now() - 86400000).toISOString().split('T')[0];
  
  return [
    {
      id: 1,
      title: "Seed Lettuce Trays",
      completionDate: today,
      isOverdue: checkIfOverdue(today), // Will be false unless after 8:30 PM
      // ... other fields
    },
    {
      id: 2,
      title: "Remove Blackout Covers",
      completionDate: yesterday,
      isOverdue: checkIfOverdue(yesterday), // Will be true (past date)
      // ... other fields
    }
    // ... more tasks
  ];
};
```

## 5. Visual Indicator for Today's Tasks After 8:30 PM

Consider adding a special indicator for tasks due today that become overdue after 8:30 PM:

```javascript
// In TaskCard component
const getOverdueMessage = (task) => {
  if (!task.isOverdue) return null;
  
  const today = new Date().toISOString().split('T')[0];
  if (task.completionDate === today) {
    return "⚠️ OVERDUE (8:30 PM deadline passed)";
  }
  return "⚠️ OVERDUE";
};
```

## Test the Fix

1. Create a task due today - it should NOT show as overdue (unless it's after 8:30 PM)
2. Create a task due yesterday - it SHOULD show as overdue
3. If testing before 8:30 PM, wait or temporarily change the time check to test
4. Verify completed tasks are never marked as overdue

The key is that tasks due today only become overdue after 8:30 PM, not immediately.